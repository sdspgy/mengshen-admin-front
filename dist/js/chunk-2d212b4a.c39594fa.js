(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d212b4a"],{aa0d:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("Row",[i("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入渠道"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.queryOperation()}},model:{value:e.page.operation.channel,callback:function(t){e.$set(e.page.operation,"channel",t)},expression:"page.operation.channel"}}),i("Button",{attrs:{type:"primary"},on:{click:function(t){return e.queryOperation()}}},[e._v("查询")]),i("Button",{on:{click:function(t){return e.openDialog()}}},[e._v("添加随机兑换码")]),i("Button",{on:{click:function(t){return e.openDialogWithDIY()}}},[e._v("添加自定义兑换码")])],1),i("Row",[i("Table",{ref:"table",attrs:{columns:e.columnsWithOperation,data:e.operations,stripe:""}})],1),i("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{current:e.page.operation.cur_page,total:e.page.operation.total,"page-size":e.page.operation.per_page,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.handleCurrentChange,"on-page-size-change":e.handleSizeChange}})],1),i("Modal",{attrs:{title:e.isDIY?"添加自定义兑换码礼包":"添加随机兑换码礼包","mask-closable":!1,width:"50%"},model:{value:e.dialogFormVisible,callback:function(t){e.dialogFormVisible=t},expression:"dialogFormVisible"}},[i("Form",{attrs:{model:e.form,"label-width":120}},[i("FormItem",{attrs:{label:"礼包起止时间"}},[i("DatePicker",{staticStyle:{width:"50%","max-width":"350px"},attrs:{type:"datetimerange",format:"yyyy-MM-dd HH:mm:ss",placeholder:"请选择时间日期",options:e.expireTimeOption},model:{value:e.form.formTime,callback:function(t){e.$set(e.form,"formTime",t)},expression:"form.formTime"}})],1),i("FormItem",{attrs:{label:"道具列表"}},[i("Select",{on:{"on-change":e.changeItemType},model:{value:e.itemType,callback:function(t){e.itemType=t},expression:"itemType"}},e._l(e.itemTypes,(function(e){return i("Option",{key:e.type,attrs:{label:e.label,value:e.type}})})),1),i("Select",{model:{value:e.addItemId,callback:function(t){e.addItemId=t},expression:"addItemId"}},e._l(e.itemList,(function(e){return i("Option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),i("Input",{staticStyle:{width:"160px"},attrs:{autocomplete:"off",placeholder:"请输入道具数量"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addReward()}},model:{value:e.addItemNum,callback:function(t){e.addItemNum=e._n(t)},expression:"addItemNum"}}),i("Button",{on:{click:function(t){return e.addReward()}}},[e._v("添加")]),i("Button",{on:{click:function(t){return e.clearRewards()}}},[e._v("清空")]),i("Table",{ref:"table",attrs:{columns:e.columnsWithRewards,data:e.form.rewards}})],1),i("FormItem",{attrs:{label:e.isDIY?"自定义兑换码":"兑换码数量"}},[e.isDIY?e._e():i("Input",{attrs:{autocomplete:"off",placeholder:"请输入生成兑换码数量，默认为1"},model:{value:e.form.createNum,callback:function(t){e.$set(e.form,"createNum",t)},expression:"form.createNum"}}),e.isDIY?i("Input",{attrs:{autocomplete:"off",placeholder:"请输入要生成的兑换码，英文半角逗号分隔"},model:{value:e.form.diyCdk,callback:function(t){e.$set(e.form,"diyCdk",t)},expression:"form.diyCdk"}}):e._e()],1),i("FormItem",{attrs:{label:"使用次数"}},[i("Input",{attrs:{autocomplete:"off",placeholder:"请输入兑换码使用次数，默认为1，无限制使用为-1"},model:{value:e.form.totalNum,callback:function(t){e.$set(e.form,"totalNum",t)},expression:"form.totalNum"}})],1),i("FormItem",{attrs:{label:"渠道"}},[i("Input",{attrs:{autocomplete:"off",placeholder:"请输入渠道"},model:{value:e.form.channel,callback:function(t){e.$set(e.form,"channel",t)},expression:"form.channel"}})],1)],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:function(t){return e.hideDialog()}}},[e._v("取 消")]),i("Button",{attrs:{type:"primary"},on:{click:function(t){return e.addcdkey()}}},[e._v("确定添加")])],1)],1),i("Modal",{attrs:{title:"查看兑换码","mask-closable":!1,width:"900px"},model:{value:e.dialogSeeVisible,callback:function(t){e.dialogSeeVisible=t},expression:"dialogSeeVisible"}},[i("Table",{ref:"table",attrs:{columns:e.columnsWithCDkey,data:e.cdkeys,stripe:""}}),i("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{current:e.page.cdkey.currentpage,total:e.page.cdkey.total,"page-size":e.page.cdkey.pagesize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.handleCDkeyCurrentChange,"on-page-size-change":e.handleCDkeySizeChange}})],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"primary"},on:{click:e.exportExcel}},[e._v("导出Excel")]),i("Button",{on:{click:function(t){return e.hideCDkeyDialog()}}},[e._v("取 消")])],1)],1),i("Modal",{attrs:{title:"导出Excel","mask-closable":!1,width:"50%"},model:{value:e.dialogExportExcelVisible,callback:function(t){e.dialogExportExcelVisible=t},expression:"dialogExportExcelVisible"}},[i("span",[e._v("因数据量太大将采取分批次下载，请选择下载批次！如若下载失败，请联系技术人员！")]),i("br"),e._l(Math.ceil(e.page.cdkey.total/e.downloadDataLimit),(function(t){return i("Button",{key:t,staticStyle:{width:"200px",margin:"10px"},attrs:{tBype:"primary"},on:{click:function(i){return e.exportExcelInBatches(t)}}},[e._v(e._s((t-1)*e.downloadDataLimit+1)+"-"+e._s(t*e.downloadDataLimit)+"\n    ")])}))],2),i("Modal",{attrs:{title:"已领取玩家","mask-closable":!1,width:"50%"},model:{value:e.dialogSeeUserVisible,callback:function(t){e.dialogSeeUserVisible=t},expression:"dialogSeeUserVisible"}},[i("Table",{ref:"table",attrs:{columns:e.columnsWithUsers,data:e.users,stripe:""}}),i("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[i("Page",{attrs:{current:e.page.user.currentpage,total:e.page.user.total,"page-size":e.page.user.pagesize,"page-size-opts":[10,20,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.handleUserCurrentChange,"on-page-size-change":e.handleUserSizeChange}})],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:function(t){return e.hideSeeUserDialog()}}},[e._v("取 消")])],1)],1)],1)},r=[],n=i("365c"),o=i("c276"),s={name:"cdkey",mounted:function(){this.getItemList(),this.getOperation()},data:function(){var e=this;return{columnsWithOperation:[{type:"index",width:60,align:"center"},{title:"生成时间",key:"createTime",width:180,align:"center",render:function(e,t){return e("div",o["a"].Time2DefaultFormat(t.row.createTime))}},{title:"开始时间",key:"startTime",width:180,align:"center",render:function(e,t){return e("div",o["a"].Time2DefaultFormat(t.row.startTime))}},{title:"结束时间",key:"endTime",width:180,align:"center",render:function(e,t){return e("div",o["a"].Time2DefaultFormat(t.row.endTime))}},{title:"道具内容",key:"rewards",width:200,align:"center",render:function(t,i){return t("div",e.formatReward(i.row.rewards))}},{title:"生成数量",key:"createNum",width:120,align:"center",render:function(e,t){var i="";return t.row.discardNum&&t.row.discardNum>0&&(i="(-".concat(t.row.discardNum,")")),e("div",t.row.createNum+i)}},{title:"可使用次数",key:"totalNum",width:120,align:"center"},{title:"渠道",key:"channel",width:120,align:"center"},{title:"操作",key:"action",width:100,align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"primary",size:"small"},on:{click:function(){e.openCDkeyDialog(i.row)}}},"查看")])}}],columnsWithRewards:[{type:"index",width:60,align:"center"},{title:"道具ID",key:"id",width:120,align:"center"},{title:"道具名称",key:"id",width:120,align:"center",render:function(t,i){return t("div",e.formatItem(i.row.id))}},{title:"道具数量",key:"num",width:120,align:"center"},{title:"操作",key:"action",width:100,align:"center",render:function(t,i){return t("div",[t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.delReward(i.index)}}},"删除")])}}],columnsWithCDkey:[{type:"index",width:60,align:"center"},{title:"兑换码ID",key:"key",width:110,align:"center"},{title:"领取状态",key:"useNum",width:120,align:"center",render:function(e,t){return e("div",t.row.useNum>0?"已领取":"未领取")}},{title:"领取时间",key:"fistUseTime",width:120,align:"center",render:function(e,t){return e("div",t.row.fistUseTime?o["a"].Time2DefaultFormat(t.row.fistUseTime):"未领取")}},{title:"用户ID",key:"fistUsrUserId",width:120,align:"center"},{title:"已使用次数",key:"useNum",width:110,align:"center"},{title:"操作",key:"action",width:200,align:"center",render:function(t,i){var a="";return e.$route.meta.permTypes.includes("delete")&&(a=t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.deleteCDkey(i.row)}}},"删除")),t("div",[t("Button",{props:{type:"primary",size:"small"},on:{click:function(){e.openSeeUserDialog(i.row.key)}}},"使用详情"),a])}}],columnsWithUsers:[{type:"index",width:60,align:"center"},{title:"兑换码",key:"key",width:110,align:"center"},{title:"用户ID",key:"userId",width:110,align:"center"},{title:"领取时间",key:"useTime",width:110,align:"center",render:function(e,t){return e("div",o["a"].Time2DefaultFormat(t.row.useTime))}}],dialogFormVisible:!1,dialogSeeVisible:!1,dialogSeeUserVisible:!1,dialogExportExcelVisible:!1,downloadDataLimit:5e4,formLabelWidth:"120px",page:{operation:{per_page:10,cur_page:1,total:0,channel:""},cdkey:{pagesize:10,currentpage:1,total:0,currentOperation:{}},user:{pagesize:10,currentpage:1,total:0,key:""}},operations:[],cdkeys:[],users:[],isDIY:!1,form:{diyCdk:"",formTime:[],rewards:[],createNum:"",totalNum:"",channel:""},itemType:0,itemList:[],itemLists:[],itemData:{itemList:{},decoShopList:{},staffList:{},goodList:{}},itemTypes:[{type:0,label:"货币"},{type:1,label:"道具"},{type:2,label:"家具"},{type:3,label:"员工"},{type:4,label:"货物"}],addItemId:"",addItemNum:"",expireTimeOption:{disabledDate:function(e){return e.getTime()<new Date((new Date).toLocaleDateString()).getTime()}}}},methods:{getItemList:function(){var e=this;Object(n["db"])().then((function(t){200===t.status&&(e.itemData.decoShopList=t.data.decoShopList,e.itemData.itemList=t.data.itemList,e.itemData.staffList=t.data.staffList,e.itemData.goodList=t.data.goodList,e.itemLists=[{id:-1,name:"经验"},{id:-2,name:"黄金"},{id:-3,name:"钻石"}],t.data.decoShopList.forEach((function(t){e.itemLists.push({id:t.id,name:t.name})})),t.data.itemList.forEach((function(t){e.itemLists.push({id:t.id,name:t.name})})),t.data.staffList.forEach((function(t){e.itemLists.push({id:t.id,name:t.name})})),t.data.goodList.forEach((function(t){e.itemLists.push({id:t.id,name:t.name})})))}))},changeItemType:function(){switch(this.itemList=[],this.clearAddItem(),this.itemType){case 0:return this.itemList.push({id:-1,name:"经验"}),this.itemList.push({id:-2,name:"黄金"}),void this.itemList.push({id:-3,name:"钻石"});case 1:return void(this.itemList=this.itemData.itemList);case 2:return void(this.itemList=this.itemData.decoShopList);case 3:return void(this.itemList=this.itemData.staffList);case 4:this.itemList=this.itemData.goodList}},queryOperation:function(){this.page.operation.currentpage=1,this.getOperation()},getOperation:function(){var e=this;Object(n["kb"])(this.page.operation).then((function(t){200===t.status&&(e.operations=t.data.operations,e.page.operation.total=t.data.total)}))},handleSizeChange:function(e){this.page.operation.per_page=e,this.getOperation()},handleCurrentChange:function(e){this.page.operation.cur_page=e,this.getOperation()},handleCDkeySizeChange:function(e){this.page.cdkey.pagesize=e,this.getCDkey()},handleCDkeyCurrentChange:function(e){this.page.cdkey.currentpage=e,this.getCDkey()},handleUserSizeChange:function(e){this.page.user.pagesize=e,this.getUseUser()},handleUserCurrentChange:function(e){this.page.user.currentpage=e,this.getUseUser()},openDialog:function(){this.itemList.length<=0&&this.getItemList(),this.itemType=0,this.changeItemType(),this.form={diyCdk:"",rewards:[],createNum:"",totalUseNum:"",channel:"",rewardStr:""},this.dialogFormVisible=!0,this.isDIY=!1},openDialogWithDIY:function(){this.openDialog(),this.isDIY=!0},hideDialog:function(){this.dialogFormVisible=!1},addcdkey:function(){var e=this;this.form.formTime?this.form.rewards&&0!==this.form.rewards.length?this.form.channel?(this.form.createNum||(this.form.createNum=1),this.form.totalNum||(this.form.totalNum=1),!this.isDIY||this.form.diyCdk?(this.form.formTime.forEach((function(t,i){e.form.formTime[i]=t.getTime()})),this.form.rewards.forEach((function(t,i){e.form.rewards[i]=t.id+","+t.num})),this.form.rewardStr=this.form.rewards.join(";"),this.form.isDiy=this.isDIY,this.hideDialog(),Object(n["j"])(this.form).then((function(t){if(200===t.status){if(t.data.error)return void e.$Message.error(t.data.error);t.data.insertFail&&e.$Message.error("兑换码"+t.data.insertFail.slice(0,-1)+"已存在"),t.data.success>0&&e.$Message.success("成功生成"+t.data.success+"条CDkey"),e.getOperation()}}))):this.$Message.error("请输入自定义兑换码")):this.$Message.error("请输入渠道"):this.$Message.error("请添加道具"):this.$Message.error("请选择时间")},addReward:function(){if(!this.addItemNum||!this.addItemId||this.addItemNum<=0)this.$Message.error("请正确添加");else{this.form.rewards.push({id:this.addItemId,num:this.addItemNum});var e=[];this.form.rewards.forEach((function(t){var i=e.findIndex((function(e){return t.id===e.id}));-1!==i?e[i].num=e[i].num+t.num:e.push(t)})),this.form.rewards=e,this.clearAddItem()}},clearAddItem:function(){this.addItemId="",this.addItemNum=""},clearRewards:function(){this.form.rewards=[]},delReward:function(e){this.form.rewards.splice(e,1)},openCDkeyDialog:function(e){this.page.cdkey.currentOperation=e,this.page.cdkey.currentpage=1,this.getCDkey(),this.dialogSeeVisible=!0},getCDkey:function(){var e=this;Object(n["X"])({per_page:this.page.cdkey.pagesize,cur_page:this.page.cdkey.currentpage,operationId:this.page.cdkey.currentOperation.operationId}).then((function(t){200===t.status&&(e.page.cdkey.total=t.data.total,e.cdkeys=t.data.cdkeys)}))},hideCDkeyDialog:function(){this.dialogSeeVisible=!1,this.getOperation()},openSeeUserDialog:function(e){this.page.user.key=e,this.page.user.currentpage=1,this.getUseUser(),this.dialogSeeUserVisible=!0},deleteCDkey:function(e){var t=this;e.useNum>0?this.$Message.error("该条cdkey已被使用"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除 "+e.key+" ?",loading:!0,onOk:function(){Object(n["r"])({key:e.key}).then((function(e){t.$Modal.remove(),200===e.status&&(e.data.error?t.$Message.error(e.data.error):t.$Message.success("成功删除"+e.data.success+"条CDkey"),t.getCDkey())}))}})},getUseUser:function(){var e=this;Object(n["tb"])({per_page:this.page.user.pagesize,cur_page:this.page.user.currentpage,key:this.page.user.key}).then((function(t){200===t.status&&(e.page.user.total=t.data.total,e.users=t.data.users)}))},exportExcel:function(){this.page.cdkey.total>this.downloadDataLimit?this.dialogExportExcelVisible=!0:this.getExportExcel(0,this.page.cdkey.total)},exportExcelInBatches:function(e){this.getExportExcel((e-1)*this.downloadDataLimit,this.downloadDataLimit)},getExportExcel:function(e,t){Object(n["O"])({operationId:this.page.cdkey.currentOperation.operationId,startIndex:e,pageSize:t}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),i=document.createElement("a");i.style.display="none",i.href=t;var a=e.headers["content-disposition"].split("filename=");a[1]=o["a"].Time2DefaultFormat((new Date).getTime())+".xlsx",i.setAttribute("download",a[1]),document.body.appendChild(i),i.click()}))},hideSeeUserDialog:function(){this.dialogSeeUserVisible=!1},formatReward:function(e){var t=this,i=e.split(";"),a=[];return i.forEach((function(e){var i=t.itemLists.findIndex((function(t){return parseInt(e.split(",")[0])===t.id}));-1!==i?a.push(t.itemLists[i].name+"*"+e.split(",")[1]):a.push(e.split(",")[0]+"*"+e.split(",")[1])})),a.join(", ")},formatItem:function(e){var t="";return this.itemLists.forEach((function(i){i.id===e&&(t=i.name)})),t}}},l=s,d=i("2877"),c=Object(d["a"])(l,a,r,!1,null,"c44ce89a",null);t["default"]=c.exports}}]);