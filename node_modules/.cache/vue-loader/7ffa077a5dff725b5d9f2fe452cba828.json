{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/upload-json/uploadJson.vue?vue&type=style&index=0&id=5f280f52&scoped=true&lang=css&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/upload-json/uploadJson.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#loadResult{\n  max-width: 90%;\n  word-wrap: break-word;\n  word-break: break-all;\n  overflow: hidden;\n}\npre {outline: 1px solid #ccc; padding: 5px; margin: 5px; }\n\n",{"version":3,"sources":["uploadJson.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+LA;AACA;AACA;AACA;AACA;AACA;AACA","file":"uploadJson.vue","sourceRoot":"src/views/game/upload-json","sourcesContent":["<template>\n  <div>\n    <Divider>JSON上传</Divider>\n    <Upload\n      multiple\n      ref=\"upload\"\n      type=\"drag\"\n      accept=\".json, .JSON\"\n      :max-size=\"5000\"\n      :before-upload=\"handleUpload\"\n      action=\"#\"\n    >\n      <div style=\"padding: 20px 0\">\n        <Icon type=\"ios-cloud-upload\" size=\"52\" style=\"color: #3399ff\"></Icon>\n        <p>点击或者拖拽到此次上传文件</p>\n      </div>\n    </Upload>\n    <div>\n      <ul class=\"file-list\" v-for=\"(file,index) in fileList\" :key=\"index\">\n        <li>文件名: <span style=\"font-size:15px;\">{{ file.name }} </span> <Button @click=\"deleteFile(index)\">删除</Button></li>\n      </ul>\n    </div>\n    <Button type=\"primary\"  @click=\"upload\" v-if=\"this.$route.meta.permTypes.includes('upload')\">上传</Button>\n    <Button type=\"primary\"  @click=\"upload\" v-else=\"!this.$route.meta.permTypes.includes('upload')\" disabled>上传</Button>\n\n    <h2 v-show=\"succesList.length>0\">成功信息</h2>\n    <ul class=\"file-list\" v-for=\"(item,index) in succesList\" :key=\"index\">\n      <li><span style=\"font-size:15px;\">{{ item }}</span></li>\n    </ul>\n    <h2 v-show=\"errorList.length>0\">错误信息</h2>\n    <ul class=\"file-list\" v-for=\"(item,index) in errorList\" :key=\"index\">\n      <li><span style=\"font-size:15px;\">{{ item }}</span></li>\n    </ul>\n\n    <Divider>查看服务器JSON</Divider>\n    <Input type=\"text\" v-model=\"fileName\" clearable placeholder=\"请输入文件名 xxx.json\" style=\"width: 200px\"/>\n    <Button @click=\"openDialog\">查看服务器JSON</Button>\n\n    <Modal title=服务器JSON v-model=\"dialogFormVisible\" :mask-closable=\"false\" width=\"1000\">\n      <Button @click=\"clickCopyPre()\">点击复制</Button><br>\n      <pre id=\"copyPre\">\n        {{jsonStr}}\n      </pre>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <Button @click=\"hideDialog()\">取 消</Button>\n      </div>\n    </Modal>\n\n    <Divider>服务器列表</Divider>\n\n    <Row  v-show=\"this.$route.meta.permTypes.includes('other')\">\n      <Table border :columns=\"columns\" :data=\"serverList\" ref=\"table\"></Table>\n      <Button @click=\"loadRemoteConfig()\" type=\"info\" :loading=\"loading\">加载远程配置</Button>\n    </Row>\n  </div>\n</template>\n\n<script>\n    import {uploadJson,loadRemoteConfigs,getListByEnable,getJsonByName} from \"@/api/index\";\n\n    export default {\n        name: \"uploadJson\",\n        data () {\n            return {\n                fileList: [],\n                errorList: [],\n                succesList: [],\n                serverList: [],\n                isShow: true,\n                loading: false,\n                fileName:'',\n                jsonStr:'',\n                jsonStrFormat: '',\n                dialogFormVisible: false,\n                columns: [\n                    {type: \"index\", width: 60, align: \"center\"},\n                    {title: \"服务器名称\", key: \"name\", align: \"center\", width: 150},\n                    {title: \"服务器地址\", key: \"address\", align: \"center\", width: 150,},\n                    {title: \"端口\", key: \"port\", align: \"center\", width: 100,},\n                    {title: \"请求url\", key: \"requestUrl\", align: \"center\", width: 200,},\n                    {title: \"加载状态\", key: \"success\", align: \"center\", width: 100,\n                        render: (h, params) => {\n                            if (this.isShow) {\n                                return h(\"div\", params.row.success);\n                            } else  {\n                                return '';\n                            }\n                        }},\n                    {title: \"加载远程配置返回信息\", key: \"msg\", align: \"center\", width: 300,},\n                ],\n            }\n        },\n        methods: {\n            init() {\n                this.getServerList();\n            },\n            handleUpload (file) {\n                this.fileList.push(file);\n                return false;\n            },\n            upload () {\n                console.log('>>>>', this.fileList)\n                if (this.fileList.length == 0) {\n                    this.$Message.error('未选择文件！');\n                    return;\n                }\n                let formData = new FormData();\n                for(var i=0; i< this.fileList.length; i++){\n                    formData.append(\"file\",this.fileList[i]);\n                }\n                uploadJson(formData).then(res=>{\n                    if (res.status === 200) {\n                        this.fileList = [];\n                        this.$Message.success('上传成功');\n                        this.succesList = res.data.succ;\n                        this.errorList = res.data.error;\n                    }else {\n                        this.$Message.error(res.data);\n                    }\n                })\n            },\n            deleteFile(index) {\n                this.fileList.splice(index,1);\n            },\n            getServerList() {\n                if (!this.$route.meta.permTypes.includes('other')) {\n                    return\n                }\n                getListByEnable().then(res =>{\n                    if (res.success){\n                        this.isShow = false;\n                        this.serverList = res.result;\n                    }\n                })\n            },\n            loadRemoteConfig() {\n                this.loading = true;\n                loadRemoteConfigs().then(res=>{\n                    this.loading = false;\n                    this.serverList = res.result;\n                })\n            },\n            openDialog() {\n                this.getJsonByName();\n            },\n            hideDialog() {\n                this.dialogFormVisible = false;\n            },\n            getJsonByName(){\n                this.jsonStr = '';\n                getJsonByName({fileName: this.fileName}).then(res=>{\n                    if (res.status === 200){\n                        if (res.data.error){\n                            this.hideDialog();\n                            this.$Message.error(res.data.error);\n                        }else {\n                            this.dialogFormVisible = true;\n                            this.jsonStr = res.data.jsonStr;\n                        }\n                    }\n                })\n            },\n            clickCopyPre(){\n                var div = document.getElementById('copyPre');\n                if (document.body.createTextRange) {\n                    var range = document.body.createTextRange();\n                    range.moveToElementText(div);\n                    range.select();\n                } else if (window.getSelection) {\n                    var selection = window.getSelection();\n                    var range = document.createRange();\n                    range.selectNodeContents(div);\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                } else {\n                    console.warn(\"none\");\n                }\n                document.execCommand(\"Copy\"); // 执行浏览器复制命令\n\n                this.$Message.success(`复制成功`);\n            },\n        },\n        mounted() {\n            this.init();\n        }\n\n    }\n</script>\n\n<style scoped>\n\n  #loadResult{\n    max-width: 90%;\n    word-wrap: break-word;\n    word-break: break-all;\n    overflow: hidden;\n  }\n  pre {outline: 1px solid #ccc; padding: 5px; margin: 5px; }\n\n</style>\n"]}]}