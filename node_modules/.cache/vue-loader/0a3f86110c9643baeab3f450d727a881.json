{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/sys/menu-manage/menuManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/sys/menu-manage/menuManage.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n  getAllPermissionList,\n  addPermission,\n  editPermission,\n  deletePermission,\n  searchPermission,\n  getDictDataByType\n} from \"@/api/index\";\nimport IconChoose from \"@/views/my-components/icon-choose\";\nimport util from \"@/libs/util.js\";\nexport default {\n  name: \"menu-manage\",\n  components: {\n    IconChoose\n  },\n  data() {\n    return {\n      loading: true,\n      strict: true,\n      maxHeight: \"500px\",\n      expandLevel: 1,\n      menuModalVisible: false,\n      iconModalVisible: false,\n      selectList: [],\n      selectCount: 0,\n      showParent: false,\n      searchKey: \"\",\n      parentTitle: \"\",\n      editTitle: \"\",\n      modalTitle: \"\",\n      menuForm: {\n        id: \"\",\n        title: \"\",\n        name: \"\",\n        icon: \"\",\n        path: \"\",\n        component: \"\",\n        parentId: \"\",\n        buttonType: \"\",\n        type: 0,\n        sortOrder: 0,\n        level: null,\n        status: 0,\n        url: \"\",\n        showAlways: true\n      },\n      menuFormAdd: {\n        buttonType: \"\"\n      },\n      menuFormValidate: {\n        title: [{ required: true, message: \"名称不能为空\", trigger: \"blur\" }],\n        name: [\n          { required: true, message: \"路由英文名不能为空\", trigger: \"blur\" }\n        ],\n        icon: [{ required: true, message: \"图标不能为空\", trigger: \"click\" }],\n        path: [{ required: true, message: \"路径不能为空\", trigger: \"blur\" }],\n        component: [\n          { required: true, message: \"前端组件不能为空\", trigger: \"blur\" }\n        ]\n      },\n      submitLoading: false,\n      data: [],\n      dictPermissions: []\n    };\n  },\n  methods: {\n    init() {\n      this.getAllList();\n      this.getDictPermissions();\n    },\n    getDictPermissions() {\n      if (!this.$route.meta.permTypes.includes('view')){\n        this.loading = false;\n        return;\n      }\n      getDictDataByType(\"permission_type\").then(res => {\n        if (res.success) {\n          this.dictPermissions = res.result;\n        }\n      });\n    },\n    renderContent(h, { root, node, data }) {\n      let icon = \"\";\n      if (data.level == 0) {\n        icon = \"ios-navigate\";\n      } else if (data.level == 1) {\n        icon = \"md-list-box\";\n      } else if (data.level == 2) {\n        icon = \"md-list\";\n      } else if (data.level == 3) {\n        icon = \"md-radio-button-on\";\n      } else {\n        icon = \"md-radio-button-off\";\n      }\n      return h(\n        \"span\",\n        {\n          style: {\n            display: \"inline-block\",\n            cursor: \"pointer\"\n          },\n          on: {\n            click: () => {\n              this.selectTree(data);\n            }\n          }\n        },\n        [\n          h(\"span\", [\n            h(\"Icon\", {\n              props: {\n                type: icon,\n                size: \"16\"\n              },\n              style: {\n                \"margin-right\": \"8px\",\n                \"margin-bottom\": \"3px\"\n              }\n            }),\n            h(\n              \"span\",\n              {\n                class: {\n                  \"ivu-tree-title\": true,\n                  \"ivu-tree-title-selected\": data.id == this.menuForm.id\n                }\n              },\n              data.title\n            )\n          ])\n        ]\n      );\n    },\n    handleDropdown(name) {\n      if (name == \"expandOne\") {\n        this.expandLevel = 1;\n        this.getAllList();\n      } else if (name == \"expandTwo\") {\n        this.expandLevel = 2;\n        this.getAllList();\n      } else if (name == \"expandThree\") {\n        this.expandLevel = 3;\n        this.getAllList();\n      }\n      if (name == \"expandAll\") {\n        this.expandLevel = 4;\n        this.getAllList();\n      } else if (name == \"refresh\") {\n        this.getAllList();\n      }\n    },\n    getAllList() {\n      if (!this.$route.meta.permTypes.includes('view')){\n        this.loading = false;\n        return;\n      }\n      this.loading = true;\n      this.getRequest(\"/permission/getAllList\").then(res => {\n        this.loading = false;\n        if (res.success) {\n          // 仅展开指定级数 默认后台已展开所有\n          let expandLevel = this.expandLevel;\n          res.result.forEach(function(e) {\n            if (expandLevel == 1) {\n              if (e.level == 0) {\n                e.expand = false;\n              }\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function(c) {\n                  if (c.level == 1) {\n                    c.expand = false;\n                  }\n                  if (c.children && c.children.length > 0) {\n                    c.children.forEach(function(b) {\n                      if (b.level == 2) {\n                        b.expand = false;\n                      }\n                    });\n                  }\n                });\n              }\n            } else if (expandLevel == 2) {\n              if (e.level == 0) {\n                e.expand = true;\n              }\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function(c) {\n                  if (c.level == 1) {\n                    c.expand = false;\n                  }\n                  if (c.children && c.children.length > 0) {\n                    c.children.forEach(function(b) {\n                      if (b.level == 2) {\n                        b.expand = false;\n                      }\n                    });\n                  }\n                });\n              }\n            } else if (expandLevel == 3) {\n              if (e.level == 0) {\n                e.expand = true;\n              }\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function(c) {\n                  if (c.level == 1) {\n                    c.expand = true;\n                  }\n                  if (c.children && c.children.length > 0) {\n                    c.children.forEach(function(b) {\n                      if (b.level == 2) {\n                        b.expand = false;\n                      }\n                    });\n                  }\n                });\n              }\n            }\n          });\n          this.data = res.result;\n        }\n      });\n    },\n    search() {\n      if (this.searchKey) {\n        this.loading = true;\n        searchPermission({ title: this.searchKey }).then(res => {\n          this.loading = false;\n          if (res.success) {\n            this.data = res.result;\n          }\n        });\n      } else {\n        this.getAllList();\n      }\n    },\n    selectTree(v) {\n      if (v && v.id != this.menuForm.id) {\n        // 转换null为\"\"\n        for (let attr in v) {\n          if (v[attr] == null) {\n            v[attr] = \"\";\n          }\n        }\n        let str = JSON.stringify(v);\n        let menu = JSON.parse(str);\n        this.menuForm = menu;\n        this.editTitle = menu.title;\n      } else {\n        this.cancelEdit();\n      }\n    },\n    cancelEdit() {\n      let data = this.$refs.tree.getSelectedNodes()[0];\n      if (data) {\n        data.selected = false;\n      }\n      this.$refs.menuForm.resetFields();\n      this.menuForm.id = \"\";\n      delete this.menuForm.id;\n      this.editTitle = \"\";\n    },\n    cancelAdd() {\n      this.menuModalVisible = false;\n    },\n    handleReset() {\n      let type = this.menuForm.type;\n      this.$refs.menuForm.resetFields();\n      this.menuForm.icon = \"\";\n      this.menuForm.component = \"\";\n      this.menuForm.type = type;\n    },\n    submitEdit() {\n      this.$refs.menuForm.validate(valid => {\n        if (valid) {\n          if (!this.menuForm.id) {\n            this.$Message.warning(\"请先点击选择要修改的菜单节点\");\n            return;\n          }\n          this.submitLoading = true;\n          if (this.menuForm.sortOrder == null) {\n            this.menuForm.sortOrder = \"\";\n          }\n          if (this.menuForm.buttonType == null) {\n            this.menuForm.buttonType = \"\";\n          }\n          if (this.menuForm.type == 1) {\n            this.menuForm.name = \"\";\n            this.menuForm.icon = \"\";\n            this.menuForm.component = \"\";\n          }\n          delete this.menuForm.children\n          editPermission(this.menuForm).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"编辑成功\");\n              // 标记重新获取菜单数据\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.init();\n              this.menuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    submitAdd() {\n      this.$refs.menuFormAdd.validate(valid => {\n        if (valid) {\n          this.submitLoading = true;\n          if (this.menuFormAdd.type == 1) {\n            this.menuFormAdd.name = \"\";\n            this.menuFormAdd.icon = \"\";\n            this.menuFormAdd.component = \"\";\n          }\n          delete this.menuForm.children\n          addPermission(this.menuFormAdd).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"添加成功\");\n              // 标记重新获取菜单数据\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.init();\n              this.menuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    addMenu() {\n      if (this.menuForm.id == \"\" || this.menuForm.id == null) {\n        this.$Message.warning(\"请先点击选择一个菜单权限节点\");\n        return;\n      }\n      this.parentTitle = this.menuForm.title;\n      this.modalTitle = \"添加子节点(可拖动)\";\n      this.showParent = true;\n      let type = 0;\n      if (this.menuForm.level == 1) {\n        type = 0;\n      } else if (this.menuForm.level == 2) {\n        type = 1;\n      } else if (this.menuForm.level == 3) {\n        this.$Modal.warning({\n          title: \"抱歉，不能添加啦\",\n          content: \"仅支持2级菜单目录\"\n        });\n        return;\n      } else {\n        type = 0;\n      }\n      let component = \"\";\n      this.menuFormAdd = {\n        icon: \"\",\n        type: type,\n        parentId: this.menuForm.id,\n        level: Number(this.menuForm.level) + 1,\n        sortOrder: 0,\n        buttonType: \"\",\n        status: 0,\n        showAlways: true\n      };\n      if (this.menuForm.level == 0) {\n        this.menuFormAdd.path = \"/\";\n        this.menuFormAdd.component = \"Main\";\n      }\n      this.menuModalVisible = true;\n    },\n    addRootMenu() {\n      this.modalTitle = \"添加顶部菜单(可拖动)\";\n      this.showParent = false;\n      this.menuFormAdd = {\n        type: -1,\n        level: 0,\n        sortOrder: 0,\n        status: 0\n      };\n      this.menuModalVisible = true;\n    },\n    changeSelect(v) {\n      this.selectCount = v.length;\n      this.selectList = v;\n    },\n    delAll() {\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未勾选要删除的数据\");\n        return;\n      }\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\n        onOk: () => {\n          let ids = \"\";\n          this.selectList.forEach(function(e) {\n            ids += e.id + \",\";\n          });\n          ids = ids.substring(0, ids.length - 1);\n          deletePermission(ids).then(res => {\n            if (res.success) {\n              this.$Message.success(\"删除成功\");\n              // 标记重新获取菜单数据\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.selectList = [];\n              this.selectCount = 0;\n              this.cancelEdit();\n              this.init();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    // 计算高度\n    let height = document.documentElement.clientHeight;\n    this.maxHeight = Number(height - 287) + \"px\";\n    this.init();\n  }\n};\n",{"version":3,"sources":["menuManage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"menuManage.vue","sourceRoot":"src/views/sys/menu-manage","sourcesContent":["<style lang=\"less\">\n@import \"./menuManage.less\";\n</style>\n<template>\n  <div class=\"search\">\n    <Card>\n      <Row class=\"operation\">\n        <Button @click=\"addMenu\" type=\"primary\" icon=\"md-add\" v-show=\"this.$route.meta.permTypes.includes('add')\">添加子节点</Button>\n        <Button @click=\"addRootMenu\" icon=\"md-add\" v-show=\"this.$route.meta.permTypes.includes('add')\">添加顶部菜单</Button>\n        <Button @click=\"delAll\" icon=\"md-trash\" v-show=\"this.$route.meta.permTypes.includes('delete')\">批量删除</Button>\n        <Dropdown @on-click=\"handleDropdown\">\n          <Button>\n            更多操作\n            <Icon type=\"md-arrow-dropdown\"></Icon>\n          </Button>\n          <DropdownMenu slot=\"list\">\n            <DropdownItem name=\"refresh\" v-show=\"this.$route.meta.permTypes.includes('view')\">刷新</DropdownItem>\n            <DropdownItem name=\"expandOne\">收合所有</DropdownItem>\n            <DropdownItem name=\"expandTwo\">仅展开一级</DropdownItem>\n            <DropdownItem name=\"expandThree\">仅展开两级</DropdownItem>\n            <DropdownItem name=\"expandAll\">展开所有</DropdownItem>\n          </DropdownMenu>\n        </Dropdown>\n        <i-switch v-model=\"strict\" size=\"large\" style=\"margin-left:5px\">\n          <span slot=\"open\">级联</span>\n          <span slot=\"close\">单选</span>\n        </i-switch>\n      </Row>\n      <Row type=\"flex\" justify=\"start\" class=\"code-row-bg\">\n        <Col span=\"6\">\n          <Alert show-icon>\n            当前选择编辑：\n            <span class=\"select-title\">{{editTitle}}</span>\n            <a class=\"select-clear\" v-if=\"menuForm.id\" @click=\"cancelEdit\">取消选择</a>\n          </Alert>\n          <Input\n            v-model=\"searchKey\"\n            suffix=\"ios-search\"\n            @on-change=\"search\"\n            placeholder=\"输入菜单名搜索\"\n            clearable\n            v-show=\"this.$route.meta.permTypes.includes('search')\"\n          />\n          <div class=\"tree-bar\" :style=\"{maxHeight: maxHeight}\">\n            <Tree\n              ref=\"tree\"\n              :data=\"data\"\n              show-checkbox\n              :render=\"renderContent\"\n              @on-check-change=\"changeSelect\"\n              :check-strictly=\"!strict\"\n            ></Tree>\n          </div>\n          <Spin size=\"large\" fix v-if=\"loading\"></Spin>\n        </Col>\n        <Col span=\"9\" style=\"margin-left:10px\">\n          <Form ref=\"menuForm\" :model=\"menuForm\" :label-width=\"100\" :rules=\"menuFormValidate\">\n            <FormItem label=\"类型\" prop=\"type\">\n              <div v-show=\"menuForm.type==-1\">\n                <Icon type=\"ios-navigate-outline\" size=\"16\" style=\"margin:0 5px 3px 0;\"></Icon>\n                <span>顶部菜单</span>\n              </div>\n              <div v-show=\"menuForm.type==0\">\n                <Icon type=\"ios-list-box-outline\" size=\"16\" style=\"margin:0 5px 3px 0;\"></Icon>\n                <span>页面菜单</span>\n              </div>\n              <div v-show=\"menuForm.type==1\">\n                <Icon type=\"md-radio-button-on\" size=\"16\" style=\"margin:0 5px 3px 0;\"></Icon>\n                <span>操作按钮</span>\n              </div>\n            </FormItem>\n            <FormItem label=\"名称\" prop=\"title\" v-if=\"menuForm.type==-1||menuForm.type==0\">\n              <Input v-model=\"menuForm.title\"/>\n            </FormItem>\n            <FormItem label=\"名称\" prop=\"title\" v-if=\"menuForm.type==1\">\n              <Tooltip placement=\"right\" content=\"操作按钮名称不得重复\">\n                <Input v-model=\"menuForm.title\"/>\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"路径\" prop=\"path\" v-if=\"menuForm.type==0\">\n              <Input v-model=\"menuForm.path\"/>\n            </FormItem>\n            <FormItem label=\"请求路径\" prop=\"path\" v-if=\"menuForm.type==1\">\n              <Tooltip\n                placement=\"right\"\n                :max-width=\"230\"\n                transfer\n                content=\"填写后台请求URL，后台将作权限拦截，若无可填写'无'或其他\"\n              >\n                <Input v-model=\"menuForm.path\"/>\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"按钮权限类型\" prop=\"buttonType\" v-if=\"menuForm.type==1\">\n              <Select v-model=\"menuForm.buttonType\" placeholder=\"请选择或输入搜索\" filterable clearable>\n                <Option\n                  v-for=\"(item, i) in dictPermissions\"\n                  :key=\"i\"\n                  :value=\"item.value\"\n                >{{item.title}}</Option>\n              </Select>\n            </FormItem>\n            <FormItem label=\"英文名\" prop=\"name\" v-if=\"menuForm.type==-1\">\n              <Tooltip placement=\"right\" content=\"需唯一\">\n                <Input v-model=\"menuForm.name\"/>\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"路由英文名\" prop=\"name\" v-if=\"menuForm.type==0\">\n              <Tooltip placement=\"right\" content=\"需唯一\">\n                <Input v-model=\"menuForm.name\"/>\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"图标\" prop=\"icon\" v-if=\"menuForm.type==-1||menuForm.type==0\">\n              <icon-choose v-model=\"menuForm.icon\"></icon-choose>\n            </FormItem>\n            <FormItem label=\"前端组件\" prop=\"component\" v-if=\"menuForm.type==0\">\n              <Input v-model=\"menuForm.component\"/>\n            </FormItem>\n            <FormItem label=\"第三方网页链接\" prop=\"url\" v-if=\"menuForm.type==0\">\n              <Tooltip placement=\"right\" content=\"前端组件需为 sys/monitor/monitor 时生效\">\n                <Input v-model=\"menuForm.url\" placeholder=\"http://\"/>\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"排序值\" prop=\"sortOrder\">\n              <InputNumber :max=\"1000\" :min=\"0\" v-model=\"menuForm.sortOrder\"></InputNumber>\n              <span style=\"margin-left:5px\">值越小越靠前，支持小数</span>\n            </FormItem>\n            <FormItem label=\"始终显示\" prop=\"showAlways\" v-if=\"menuForm.level==1\">\n              <i-switch size=\"large\" v-model=\"menuForm.showAlways\">\n                <span slot=\"open\">启用</span>\n                <span slot=\"close\">禁用</span>\n              </i-switch>\n              <Tooltip\n                content=\"当设为不始终显示时，一级菜单下仅有一个子级菜单只会显示该子级菜单，避免用户多次点击\"\n                placement=\"right\"\n                transfer\n                max-width=\"280\"\n                style=\"display: inline-block !important;\"\n              >\n                <Icon\n                  type=\"md-help-circle\"\n                  size=\"20\"\n                  color=\"#c5c5c5\"\n                  style=\"margin-left:10px;cursor:pointer;\"\n                />\n              </Tooltip>\n            </FormItem>\n            <FormItem label=\"是否启用\" prop=\"status\">\n              <i-switch size=\"large\" v-model=\"menuForm.status\" :true-value=\"0\" :false-value=\"-1\">\n                <span slot=\"open\">启用</span>\n                <span slot=\"close\">禁用</span>\n              </i-switch>\n            </FormItem>\n            <Form-item>\n              <Button\n                style=\"margin-right:5px\"\n                @click=\"submitEdit\"\n                :loading=\"submitLoading\"\n                type=\"primary\"\n                icon=\"ios-create-outline\"\n                :disabled=\"!this.$route.meta.permTypes.includes('edit')\"\n              >修改并保存</Button>\n              <Button @click=\"handleReset\">重置</Button>\n            </Form-item>\n          </Form>\n        </Col>\n      </Row>\n    </Card>\n\n    <Modal\n      draggable\n      :title=\"modalTitle\"\n      v-model=\"menuModalVisible\"\n      :mask-closable=\"false\"\n      :width=\"500\"\n      :styles=\"{top: '30px'}\"\n    >\n      <Form ref=\"menuFormAdd\" :model=\"menuFormAdd\" :label-width=\"100\" :rules=\"menuFormValidate\">\n        <div v-if=\"showParent\">\n          <FormItem label=\"上级节点：\">{{parentTitle}}</FormItem>\n        </div>\n        <FormItem label=\"类型\" prop=\"type\">\n          <div v-show=\"menuFormAdd.type==-1\">\n            <Icon type=\"ios-navigate-outline\" size=\"16\" style=\"margin:0 5px 3px 0;\"></Icon>\n            <span>顶部菜单</span>\n          </div>\n          <div v-show=\"menuFormAdd.type==0\">\n            <Icon type=\"ios-list-box-outline\" size=\"16\" style=\"margin:0 5px 3px 0;\"></Icon>\n            <span>页面菜单</span>\n          </div>\n          <div v-show=\"menuFormAdd.type==1\">\n            <Icon type=\"md-radio-button-on\" size=\"16\" style=\"margin:0 5px 3px 0;\"></Icon>\n            <span>操作按钮</span>\n          </div>\n        </FormItem>\n        <FormItem label=\"名称\" prop=\"title\" v-if=\"menuFormAdd.type==-1||menuFormAdd.type==0\">\n          <Input v-model=\"menuFormAdd.title\"/>\n        </FormItem>\n        <FormItem label=\"名称\" prop=\"title\" v-if=\"menuFormAdd.type==1\">\n          <Tooltip placement=\"right\" content=\"操作按钮名称不得重复\">\n            <Input v-model=\"menuFormAdd.title\" style=\"width:368px\"/>\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"路径\" prop=\"path\" v-if=\"menuFormAdd.type==0\">\n          <Input v-model=\"menuFormAdd.path\"/>\n        </FormItem>\n        <FormItem label=\"请求路径\" prop=\"path\" v-if=\"menuFormAdd.type==1\">\n          <Tooltip\n            placement=\"right\"\n            :max-width=\"230\"\n            transfer\n            content=\"填写后台请求URL，后台将作权限拦截，若无可填写'无'或其他\"\n          >\n            <Input v-model=\"menuFormAdd.path\" style=\"width:368px\"/>\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"按钮权限类型\" prop=\"buttonType\" v-if=\"menuFormAdd.type==1\">\n          <Select v-model=\"menuFormAdd.buttonType\" placeholder=\"请选择或输入搜索\" filterable clearable>\n            <Option v-for=\"(item, i) in dictPermissions\" :key=\"i\" :value=\"item.value\">{{item.title}}</Option>\n          </Select>\n        </FormItem>\n        <FormItem label=\"英文名\" prop=\"name\" v-if=\"menuFormAdd.type==-1\">\n          <Tooltip placement=\"right\" content=\"需唯一\">\n            <Input v-model=\"menuFormAdd.name\"/>\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"路由英文名\" prop=\"name\" v-if=\"menuFormAdd.type==0\">\n          <Tooltip placement=\"right\" content=\"需唯一\">\n            <Input v-model=\"menuFormAdd.name\" style=\"width:368px\"/>\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"图标\" prop=\"icon\" v-if=\"menuFormAdd.type==-1||menuFormAdd.type==0\">\n          <icon-choose v-model=\"menuFormAdd.icon\"></icon-choose>\n        </FormItem>\n        <FormItem label=\"前端组件\" prop=\"component\" v-if=\"menuFormAdd.type==0\">\n          <Input v-model=\"menuFormAdd.component\"/>\n        </FormItem>\n        <FormItem label=\"第三方网页链接\" prop=\"url\" v-if=\"menuFormAdd.type==0\">\n          <Tooltip placement=\"right\" content=\"前端组件需为 sys/monitor/monitor 时生效\">\n            <Input v-model=\"menuFormAdd.url\" placeholder=\"http://\" style=\"width:368px\"/>\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"排序值\" prop=\"sortOrder\">\n          <InputNumber :max=\"1000\" :min=\"0\" v-model=\"menuFormAdd.sortOrder\"></InputNumber>\n          <span style=\"margin-left:5px\">值越小越靠前，支持小数</span>\n        </FormItem>\n        <FormItem label=\"始终显示\" prop=\"showAlways\" v-if=\"menuFormAdd.level==1\">\n          <i-switch size=\"large\" v-model=\"menuFormAdd.showAlways\">\n            <span slot=\"open\">启用</span>\n            <span slot=\"close\">禁用</span>\n          </i-switch>\n          <Tooltip\n            content=\"当设为不始终显示时，一级菜单下仅有一个子级菜单只会显示该子级菜单，避免用户多次点击\"\n            placement=\"right\"\n            transfer\n            max-width=\"280\"\n            style=\"display: inline-block !important;\"\n          >\n            <Icon\n              type=\"md-help-circle\"\n              size=\"20\"\n              color=\"#c5c5c5\"\n              style=\"margin-left:10px;cursor:pointer;\"\n            />\n          </Tooltip>\n        </FormItem>\n        <FormItem label=\"是否启用\" prop=\"status\">\n          <i-switch size=\"large\" v-model=\"menuFormAdd.status\" :true-value=\"0\" :false-value=\"-1\">\n            <span slot=\"open\">启用</span>\n            <span slot=\"close\">禁用</span>\n          </i-switch>\n        </FormItem>\n      </Form>\n      <div slot=\"footer\">\n        <Button type=\"text\" @click=\"cancelAdd\">取消</Button>\n        <Button type=\"primary\" :loading=\"submitLoading\" @click=\"submitAdd\">提交</Button>\n      </div>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport {\n  getAllPermissionList,\n  addPermission,\n  editPermission,\n  deletePermission,\n  searchPermission,\n  getDictDataByType\n} from \"@/api/index\";\nimport IconChoose from \"@/views/my-components/icon-choose\";\nimport util from \"@/libs/util.js\";\nexport default {\n  name: \"menu-manage\",\n  components: {\n    IconChoose\n  },\n  data() {\n    return {\n      loading: true,\n      strict: true,\n      maxHeight: \"500px\",\n      expandLevel: 1,\n      menuModalVisible: false,\n      iconModalVisible: false,\n      selectList: [],\n      selectCount: 0,\n      showParent: false,\n      searchKey: \"\",\n      parentTitle: \"\",\n      editTitle: \"\",\n      modalTitle: \"\",\n      menuForm: {\n        id: \"\",\n        title: \"\",\n        name: \"\",\n        icon: \"\",\n        path: \"\",\n        component: \"\",\n        parentId: \"\",\n        buttonType: \"\",\n        type: 0,\n        sortOrder: 0,\n        level: null,\n        status: 0,\n        url: \"\",\n        showAlways: true\n      },\n      menuFormAdd: {\n        buttonType: \"\"\n      },\n      menuFormValidate: {\n        title: [{ required: true, message: \"名称不能为空\", trigger: \"blur\" }],\n        name: [\n          { required: true, message: \"路由英文名不能为空\", trigger: \"blur\" }\n        ],\n        icon: [{ required: true, message: \"图标不能为空\", trigger: \"click\" }],\n        path: [{ required: true, message: \"路径不能为空\", trigger: \"blur\" }],\n        component: [\n          { required: true, message: \"前端组件不能为空\", trigger: \"blur\" }\n        ]\n      },\n      submitLoading: false,\n      data: [],\n      dictPermissions: []\n    };\n  },\n  methods: {\n    init() {\n      this.getAllList();\n      this.getDictPermissions();\n    },\n    getDictPermissions() {\n      if (!this.$route.meta.permTypes.includes('view')){\n        this.loading = false;\n        return;\n      }\n      getDictDataByType(\"permission_type\").then(res => {\n        if (res.success) {\n          this.dictPermissions = res.result;\n        }\n      });\n    },\n    renderContent(h, { root, node, data }) {\n      let icon = \"\";\n      if (data.level == 0) {\n        icon = \"ios-navigate\";\n      } else if (data.level == 1) {\n        icon = \"md-list-box\";\n      } else if (data.level == 2) {\n        icon = \"md-list\";\n      } else if (data.level == 3) {\n        icon = \"md-radio-button-on\";\n      } else {\n        icon = \"md-radio-button-off\";\n      }\n      return h(\n        \"span\",\n        {\n          style: {\n            display: \"inline-block\",\n            cursor: \"pointer\"\n          },\n          on: {\n            click: () => {\n              this.selectTree(data);\n            }\n          }\n        },\n        [\n          h(\"span\", [\n            h(\"Icon\", {\n              props: {\n                type: icon,\n                size: \"16\"\n              },\n              style: {\n                \"margin-right\": \"8px\",\n                \"margin-bottom\": \"3px\"\n              }\n            }),\n            h(\n              \"span\",\n              {\n                class: {\n                  \"ivu-tree-title\": true,\n                  \"ivu-tree-title-selected\": data.id == this.menuForm.id\n                }\n              },\n              data.title\n            )\n          ])\n        ]\n      );\n    },\n    handleDropdown(name) {\n      if (name == \"expandOne\") {\n        this.expandLevel = 1;\n        this.getAllList();\n      } else if (name == \"expandTwo\") {\n        this.expandLevel = 2;\n        this.getAllList();\n      } else if (name == \"expandThree\") {\n        this.expandLevel = 3;\n        this.getAllList();\n      }\n      if (name == \"expandAll\") {\n        this.expandLevel = 4;\n        this.getAllList();\n      } else if (name == \"refresh\") {\n        this.getAllList();\n      }\n    },\n    getAllList() {\n      if (!this.$route.meta.permTypes.includes('view')){\n        this.loading = false;\n        return;\n      }\n      this.loading = true;\n      this.getRequest(\"/permission/getAllList\").then(res => {\n        this.loading = false;\n        if (res.success) {\n          // 仅展开指定级数 默认后台已展开所有\n          let expandLevel = this.expandLevel;\n          res.result.forEach(function(e) {\n            if (expandLevel == 1) {\n              if (e.level == 0) {\n                e.expand = false;\n              }\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function(c) {\n                  if (c.level == 1) {\n                    c.expand = false;\n                  }\n                  if (c.children && c.children.length > 0) {\n                    c.children.forEach(function(b) {\n                      if (b.level == 2) {\n                        b.expand = false;\n                      }\n                    });\n                  }\n                });\n              }\n            } else if (expandLevel == 2) {\n              if (e.level == 0) {\n                e.expand = true;\n              }\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function(c) {\n                  if (c.level == 1) {\n                    c.expand = false;\n                  }\n                  if (c.children && c.children.length > 0) {\n                    c.children.forEach(function(b) {\n                      if (b.level == 2) {\n                        b.expand = false;\n                      }\n                    });\n                  }\n                });\n              }\n            } else if (expandLevel == 3) {\n              if (e.level == 0) {\n                e.expand = true;\n              }\n              if (e.children && e.children.length > 0) {\n                e.children.forEach(function(c) {\n                  if (c.level == 1) {\n                    c.expand = true;\n                  }\n                  if (c.children && c.children.length > 0) {\n                    c.children.forEach(function(b) {\n                      if (b.level == 2) {\n                        b.expand = false;\n                      }\n                    });\n                  }\n                });\n              }\n            }\n          });\n          this.data = res.result;\n        }\n      });\n    },\n    search() {\n      if (this.searchKey) {\n        this.loading = true;\n        searchPermission({ title: this.searchKey }).then(res => {\n          this.loading = false;\n          if (res.success) {\n            this.data = res.result;\n          }\n        });\n      } else {\n        this.getAllList();\n      }\n    },\n    selectTree(v) {\n      if (v && v.id != this.menuForm.id) {\n        // 转换null为\"\"\n        for (let attr in v) {\n          if (v[attr] == null) {\n            v[attr] = \"\";\n          }\n        }\n        let str = JSON.stringify(v);\n        let menu = JSON.parse(str);\n        this.menuForm = menu;\n        this.editTitle = menu.title;\n      } else {\n        this.cancelEdit();\n      }\n    },\n    cancelEdit() {\n      let data = this.$refs.tree.getSelectedNodes()[0];\n      if (data) {\n        data.selected = false;\n      }\n      this.$refs.menuForm.resetFields();\n      this.menuForm.id = \"\";\n      delete this.menuForm.id;\n      this.editTitle = \"\";\n    },\n    cancelAdd() {\n      this.menuModalVisible = false;\n    },\n    handleReset() {\n      let type = this.menuForm.type;\n      this.$refs.menuForm.resetFields();\n      this.menuForm.icon = \"\";\n      this.menuForm.component = \"\";\n      this.menuForm.type = type;\n    },\n    submitEdit() {\n      this.$refs.menuForm.validate(valid => {\n        if (valid) {\n          if (!this.menuForm.id) {\n            this.$Message.warning(\"请先点击选择要修改的菜单节点\");\n            return;\n          }\n          this.submitLoading = true;\n          if (this.menuForm.sortOrder == null) {\n            this.menuForm.sortOrder = \"\";\n          }\n          if (this.menuForm.buttonType == null) {\n            this.menuForm.buttonType = \"\";\n          }\n          if (this.menuForm.type == 1) {\n            this.menuForm.name = \"\";\n            this.menuForm.icon = \"\";\n            this.menuForm.component = \"\";\n          }\n          delete this.menuForm.children\n          editPermission(this.menuForm).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"编辑成功\");\n              // 标记重新获取菜单数据\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.init();\n              this.menuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    submitAdd() {\n      this.$refs.menuFormAdd.validate(valid => {\n        if (valid) {\n          this.submitLoading = true;\n          if (this.menuFormAdd.type == 1) {\n            this.menuFormAdd.name = \"\";\n            this.menuFormAdd.icon = \"\";\n            this.menuFormAdd.component = \"\";\n          }\n          delete this.menuForm.children\n          addPermission(this.menuFormAdd).then(res => {\n            this.submitLoading = false;\n            if (res.success) {\n              this.$Message.success(\"添加成功\");\n              // 标记重新获取菜单数据\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.init();\n              this.menuModalVisible = false;\n            }\n          });\n        }\n      });\n    },\n    addMenu() {\n      if (this.menuForm.id == \"\" || this.menuForm.id == null) {\n        this.$Message.warning(\"请先点击选择一个菜单权限节点\");\n        return;\n      }\n      this.parentTitle = this.menuForm.title;\n      this.modalTitle = \"添加子节点(可拖动)\";\n      this.showParent = true;\n      let type = 0;\n      if (this.menuForm.level == 1) {\n        type = 0;\n      } else if (this.menuForm.level == 2) {\n        type = 1;\n      } else if (this.menuForm.level == 3) {\n        this.$Modal.warning({\n          title: \"抱歉，不能添加啦\",\n          content: \"仅支持2级菜单目录\"\n        });\n        return;\n      } else {\n        type = 0;\n      }\n      let component = \"\";\n      this.menuFormAdd = {\n        icon: \"\",\n        type: type,\n        parentId: this.menuForm.id,\n        level: Number(this.menuForm.level) + 1,\n        sortOrder: 0,\n        buttonType: \"\",\n        status: 0,\n        showAlways: true\n      };\n      if (this.menuForm.level == 0) {\n        this.menuFormAdd.path = \"/\";\n        this.menuFormAdd.component = \"Main\";\n      }\n      this.menuModalVisible = true;\n    },\n    addRootMenu() {\n      this.modalTitle = \"添加顶部菜单(可拖动)\";\n      this.showParent = false;\n      this.menuFormAdd = {\n        type: -1,\n        level: 0,\n        sortOrder: 0,\n        status: 0\n      };\n      this.menuModalVisible = true;\n    },\n    changeSelect(v) {\n      this.selectCount = v.length;\n      this.selectList = v;\n    },\n    delAll() {\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未勾选要删除的数据\");\n        return;\n      }\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\n        onOk: () => {\n          let ids = \"\";\n          this.selectList.forEach(function(e) {\n            ids += e.id + \",\";\n          });\n          ids = ids.substring(0, ids.length - 1);\n          deletePermission(ids).then(res => {\n            if (res.success) {\n              this.$Message.success(\"删除成功\");\n              // 标记重新获取菜单数据\n              this.$store.commit(\"setAdded\", false);\n              util.initRouter(this);\n              this.selectList = [];\n              this.selectCount = 0;\n              this.cancelEdit();\n              this.init();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    // 计算高度\n    let height = document.documentElement.clientHeight;\n    this.maxHeight = Number(height - 287) + \"px\";\n    this.init();\n  }\n};\n</script>\n"]}]}