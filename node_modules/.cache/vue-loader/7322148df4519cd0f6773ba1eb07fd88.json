{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/notice/notice.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/notice/notice.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    getNoticeListData,\n    addNotice,\n    deleteNotice,\n    editNotice\n} from \"@/api/index\";\nimport util from \"../../../libs/util\";\n\nexport default {\n    name: \"notice\",\n    data() {\n        return {\n            loading: false,\n            page: {\n                per_page: 10,\n                cur_page: 1,\n                total: 0\n            },\n            formTypeStrMaxlength:6,\n            formTitleMaxlength: 20,\n            notices: [],\n            columns: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"公告ID\", key: \"id\", width: 80},\n                {title: \"发布时间\", key: \"publishTime\", width: 110, align: \"center\",render: (h, params) => {return h(\"div\", util.Time2DefaultFormat(params.row.publishTime))}},\n                {title: \"开始时间\", key: \"startTime\", width: 110, align: \"center\",render: (h, params) => {return h(\"div\", util.Time2DefaultFormat(params.row.startTime))}},\n                {title: \"结束时间\", key: \"endTime\", width: 110, align: \"center\",render: (h, params) => {return h(\"div\", util.Time2DefaultFormat(params.row.endTime))}},\n                {title: \"跳转\", key: \"frontSkipPos\", width: 80, align: \"center\",},\n                {title: \"跳转图片\", key: \"skipImg\", width: 110, align: \"center\",},\n                {title: \"标题\", key: \"title\", width: 80, align: \"center\",},\n                {title: \"公告类型\", key: \"typeStr\", width: 100, align: \"center\",},\n                {title: \"优先级\", key: \"priority\", width: 100, align: \"center\",},\n                {title: \"内容\", key: \"content\", width: 200, align: \"center\",},\n                {title: \"操作\", key: \"action\", width: 200, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [\n                            h(\"Button\", {props: {type: \"info\", size: \"small\"}, on: {click: () => {this.openEditDialog(params.row);}}}, \"编辑\"),\n                            h(\"Button\", {props: {type: \"error\", size: \"small\"}, on: {click: () => {this.deleteNotice(params.row.id);}}}, \"删除\")]);\n                    }\n                }],\n            dialogFormVisible: false,\n            dialogFormTitle: '',\n            isEdit: false,\n            form: {\n                id: -1,\n                title: '',\n                typeStr: '',\n                priority: '',\n                titleImg: '',\n                adImg: '',\n                duration: [],\n                content: '',\n                frontSkipPos: '',\n                skipImg: ''\n            },\n            disabledDate: {\n                disabledDate(date) {\n                    return date.getTime() < new Date(new Date().toLocaleDateString()).getTime();\n                }\n            }\n        }\n    },\n    methods: {\n        init() {\n            this.getNotices();\n        },\n        getNotices() {\n            getNoticeListData(this.page).then(res => {\n                this.notices = res.data.notices;\n                this.page.total = res.data.total;\n            });\n        },\n        openAddDialog() {\n            this.clearFrom();\n            this.dialogFormTitle = '添加游戏公告';\n            this.isEdit = false;\n            this.dialogFormVisible = true;\n        },\n        hideAddDialog() {\n            this.clearFrom();\n            this.dialogFormVisible = false;\n            this.getNotices();\n        },\n        openEditDialog(scopeRow) {\n            this.clearFrom();\n            this.dialogFormTitle = '修改游戏公告';\n            this.isEdit = true;\n            this.form.id = scopeRow.id;\n            this.dialogFormVisible = true;\n            this.form.title = scopeRow.title;\n            this.form.typeStr = scopeRow.typeStr;\n            this.form.priority = scopeRow.priority;\n            this.form.titleImg = scopeRow.titleImg;\n            this.form.adImg = scopeRow.adImg;\n            this.form.duration.push(new Date(scopeRow.startTime));\n            this.form.duration.push(new Date(scopeRow.endTime));\n            this.form.content = scopeRow.content;\n            this.form.frontSkipPos = scopeRow.frontSkipPos;\n            this.form.skipImg = scopeRow.skipImg;\n        },\n        clearFrom() {\n            this.form.id = -1;\n            this.form.title = '';\n            this.form.typeStr = '';\n            this.form.priority = '';\n            this.form.titleImg = '';\n            this.form.adImg = '';\n            this.form.duration = [];\n            this.form.content = '';\n            this.form.frontSkipPos = '';\n            this.form.skipImg = '';\n        },\n        checkFrom() {\n            if (this.form.duration.length !== 2) {\n                this.$Message.error('请选择时间');\n                return false;\n            }\n            if (!this.form.title || !this.form.typeStr || !this.form.priority || !this.form.content || !this.form.frontSkipPos) {\n                this.$Message.error('参数异常');\n                return false;\n            }\n            if (this.form.title.length > 20 || this.form.typeStr.length > 6) {\n                this.$Message.error('长度过长');\n                return false;\n            }\n            this.form.duration.forEach((item, index) => {\n                this.form.duration[index] = item.getTime();\n            });\n            return true;\n        },\n        addNotice() {\n            if (!this.checkFrom()) {\n                return;\n            }\n            addNotice(this.form).then(res=>{\n                this.hideAddDialog();\n                if (res.status === 200){\n                    this.$Message.success('添加成功');\n                }\n            });\n        },\n        editNotice() {\n            editNotice(this.form).then(res=>{\n                this.hideAddDialog();\n                if (res.status === 200){\n                    this.$Message.success('修改成功');\n                }\n            });\n        },\n        deleteNotice(id) {\n            deleteNotice({id:id}).then(res=>{\n                if (res.status === 200){\n                    this.$Message.success('删除成功');\n                }\n                this.getNotices();\n            });\n        },\n        changePage(v) {\n            this.page.cur_page = v;\n            this.getNotices();\n        },\n        changePageSize(v) {\n            this.page.per_page = v;\n            this.getNotices();\n        }\n    },\n    mounted() {\n        this.init();\n    }\n\n}\n",null]}