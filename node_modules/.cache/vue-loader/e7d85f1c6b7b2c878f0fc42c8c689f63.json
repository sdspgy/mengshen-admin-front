{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/user/allUsers.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/user/allUsers.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    updateUser,\n    getAllUsers,\n    getBags,\n    searchUser,\n    recharge,\n    queryStock,\n    updateStock,\n    getItemList,\n    getStaffPostInfo,\n    getAllStaffInfo,\n    getStaffInfo,\n    openVip,\n    getMarkets,\n    skipNewGuide\n} from \"@/api/index\";\nimport util from \"../../../libs/util\";\nimport BreadcrumbNav from \"../../main-components/breadcrumb-nav\";\n\nexport default {\n    name: \"allUsers\",\n    components: {BreadcrumbNav},\n    mounted() {\n        this.getUsers();\n        this.getItemList();\n    },\n    data() {\n        return {\n            columns: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {\n                    title: \"id\", key: \"id\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.user.id);\n                    }\n                },\n                {\n                    title: \"openid\", key: \"openid\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.user.openid);\n                    }\n                },\n                {title: \"accessToken\", key: \"accessToken\", width: 200, align: \"center\"},\n                {\n                    title: \"昵称\", key: \"nickName\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.user.nickName);\n                    }\n                },\n                {\n                    title: \"金币\", key: \"gold\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.user.gold);\n                    }\n                },\n                {\n                    title: \"钻石\", key: \"diamond\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.user.diamond);\n                    }\n                },\n                {\n                    title: \"等级\", key: \"level\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.user.level);\n                    }\n                },\n                {\n                    title: \"头像\", key: \"avatar\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"Avatar\", {props: {src: params.row.user.avatar}});\n                    }\n                },\n                {\n                    title: \"创建时间\", key: \"createTime\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", util.Time2DefaultFormat(params.row.user.createTime))\n                    }\n                },\n                {\n                    title: \"修改数据\", key: \"action\", width: 100, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [h(\"Button\", {\n                            props: {type: \"primary\", size: \"small\"}, on: {\n                                click: () => {\n                                    this.openDialog(params.row.user.id);\n                                }\n                            }\n                        }, \"修改数据\")]);\n                    }\n                },\n                {\n                    title: \"vip\", key: \"action\", width: 100, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [h(\"Button\", {\n                            props: {type: \"primary\", size: \"small\"}, on: {\n                                click: () => {\n                                    this.openDialog9(params.row.user.id, params.row.vip);\n                                }\n                            }\n                        }, \"vip信息\")]);\n                    }\n                },\n                {\n                    title: \"股票管理\", key: \"action\", width: 100, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [h(\"Button\", {\n                            props: {type: \"primary\", size: \"small\"}, on: {\n                                click: () => {\n                                    this.openDialog4(params.row.user.id);\n                                }\n                            }\n                        }, \"股票管理\")]);\n                    }\n                },\n                {\n                    title: \"查看背包\", key: \"action\", width: 100, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [h(\"Button\", {\n                            props: {type: \"primary\", size: \"small\"}, on: {\n                                click: () => {\n                                    this.openDialog2(params.row.user.id);\n                                }\n                            }\n                        }, \"查看背包\")]);\n                    }\n                },\n                {\n                    title: \"员工\", key: \"action\", width: 200, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [\n                            h(\"Button\", {\n                                props: {type: \"primary\", size: \"small\"}, on: {\n                                    click: () => {\n                                        this.openDialog5(params.row.user.id);\n                                    }\n                                }\n                            }, \"上岗员工\"),\n                            h(\"Button\", {\n                                props: {type: \"primary\", size: \"small\"}, on: {\n                                    click: () => {\n                                        this.openDialog6(params.row.user.id);\n                                    }\n                                }\n                            }, \"所有员工\")\n                        ]);\n                    }\n                },\n                {\n                    title: \"店铺信息\", key: \"action\", width: 100, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [h(\"Button\", {\n                            props: {type: \"primary\", size: \"small\"}, on: {\n                                click: () => {\n                                    this.openDialog8(params.row.user.id)\n                                }\n                            }\n                        }, \"查看店铺\")]);\n                    }\n                },\n            ],\n            columnsWithBag: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"xmlId\", key: \"xmlId\", width: 100, align: \"center\"},\n                {title: \"数量\", key: \"num\", width: 100, align: \"center\"},\n                {title: \"名字\", key: \"name\", width: 180, align: \"center\"},\n            ],\n            columnsWithStock: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"角色ID\", key: \"stockId\", width: 100, align: \"center\"},\n                {title: \"数量\", key: \"num\", width: 100, align: \"center\"},\n            ],\n            columnsWithPosts: [\n                {\n                    title: \"岗位\", key: \"positionId\", width: 100, align: \"center\", render: (h, params) => {\n                        let p = ''\n                        switch (params.row.positionId) {\n                            case 0:\n                                p = '收银员';\n                                break;\n                            case 1:\n                                p = '售货员';\n                                break;\n                            case 2:\n                                p = '招揽员';\n                                break;\n                            case 3:\n                                p = '理货员';\n                                break;\n                            default:\n                                p = '未知'\n                        }\n                        return h(\"div\", p)\n                    }\n                },\n                {title: \"是否有新岗位\", key: \"hasNewPos\", width: 120, align: \"center\"},\n                {title: \"岗位总分\", key: \"sumScore\", width: 120, align: \"center\"},\n                {\n                    title: \"岗位员工ID(点击员工查看员工详情)\",\n                    key: \"staffIds\",\n                    width: 300,\n                    align: \"center\",\n                    render: (h, params) => {\n                        let handles = [];\n                        params.row.staffIds.forEach(o => {\n                            if (o > 0) {\n                                handles.push(h(\"Button\", {\n                                    props: {size: \"small\"},\n                                    style: {marginRight: \"5px\"},\n                                    on: {\n                                        click: () => {\n                                            this.openDialog7(o);\n                                        }\n                                    }\n                                }, o));\n                            }\n                        })\n                        return h(\"div\", handles)\n                    }\n                },\n            ],\n            columnsWithAllStaff: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"xmlId\", key: \"xmlId\", width: 100, align: \"center\"},\n                {title: \"staffId\", key: \"staffId\", width: 60, align: \"center\"},\n                {title: \"isNew\", key: \"isNew\", width: 80, align: \"center\"},\n                {title: \"等级\", key: \"level\", width: 60, align: \"center\"},\n                {title: \"unique\", key: \"unique\", width: 60, align: \"center\"},\n                {title: \"灵巧\", key: \"patience\", width: 60, align: \"center\"},\n                {title: \"智慧\", key: \"intelligence\", width: 60, align: \"center\"},\n                {title: \"亲和\", key: \"glamour\", width: 60, align: \"center\"},\n                {title: \"体力\", key: \"power\", width: 60, align: \"center\"},\n                {\n                    title: \"操作\", key: \"action\", width: 100, align: \"center\",\n                    render: (h, params) => {\n                        return h(\"div\", [h(\"Button\", {\n                            props: {type: \"primary\", size: \"small\"}, on: {\n                                click: () => {\n                                    this.openDialog7(params.row.staffId);\n                                }\n                            }\n                        }, \"员工详情\")]);\n                    }\n                },\n\n            ],\n            columnsWithShelves: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"id\", key: \"id\", width: 100, align: \"center\"},\n                {title: \"x坐标\", key: \"x\", width: 80, align: \"center\"},\n                {title: \"y坐标\", key: \"y\", width: 80, align: \"center\"},\n                {title: \"xmlId\", key: \"xmlId\", width: 100, align: \"center\"},\n                {\n                    title: \"名称\", width: 120, align: \"center\", render: (h, params) => {\n                        return h(\"div\", this.decoShopFilter(params.row.xmlId));\n                    }\n                },\n                {\n                    title: \"人气值\", width: 80, align: \"center\", render: (h, params) => {\n                        return h(\"div\", this.decoShop2Popularity(params.row.xmlId));\n                    }\n                },\n                {title: \"旋转\", key: \"reversal\", width: 80, align: \"center\"},\n                {title: \"金币收益\", key: \"goldIncome\", width: 100, align: \"center\"},\n                {\n                    title: \"开始时间\", key: \"startTime\", width: 100, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.startTime ? util.Time2DefaultFormat(params.row.startTime) : '');\n                    }\n                },\n                {title: \"sumExp\", key: \"sumExp\", width: 100, align: \"center\"},\n                {title: \"售卖货物\", key: \"warehouseProductStr\", width: 60, align: \"center\"},\n            ],\n            columnsWithWallDeco: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"id\", key: \"id\", width: 100, align: \"center\"},\n                {title: \"x坐标\", key: \"x\", width: 80, align: \"center\"},\n                {title: \"y坐标\", key: \"y\", width: 80, align: \"center\"},\n                {title: \"xmlId\", key: \"xmlId\", width: 100, align: \"center\"},\n                {\n                    title: \"名称\", width: 120, align: \"center\", render: (h, params) => {\n                        return h(\"div\", this.decoShopFilter(params.row.xmlId));\n                    }\n                },\n                {\n                    title: \"人气值\", width: 80, align: \"center\", render: (h, params) => {\n                        return h(\"div\", this.decoShop2Popularity(params.row.xmlId));\n                    }\n                },\n                {title: \"旋转\", key: \"reversal\", width: 100, align: \"center\"},\n            ],\n            isOpenFloors: false,\n            columnsWithFloors: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"id\", key: \"id\", width: 100, align: \"center\"},\n                {\n                    title: \"x坐标\", width: 80, align: \"center\", render: (h, params) => {\n                        return h(\"div\", Math.floor(params.row.id / 1000));\n                    }\n                },\n                {\n                    title: \"y坐标\", width: 80, align: \"center\", render: (h, params) => {\n                        return h(\"div\", params.row.id % 1000);\n                    }\n                },\n                {title: \"xmlId\", key: \"xmlId\", width: 100, align: \"center\"},\n                {\n                    title: \"名称\", width: 120, align: \"center\", render: (h, params) => {\n                        return h(\"div\", this.decoShopFilter(params.row.xmlId));\n                    }\n                },\n                {\n                    title: \"人气值\", width: 80, align: \"center\", render: (h, params) => {\n                        return h(\"div\", this.decoShop2Popularity(params.row.xmlId));\n                    }\n                },\n            ],\n            posts: [],\n            allStaff: [],\n            users: [],\n            vipInfo: {},\n            markets: [],\n            currMarket: 0,\n            loading: true,\n            updateUserLoading: false,\n            pagesize: 10,\n            currentpage: 1,\n            total: 0,\n            staffPagesize: 10,\n            staffCurrentpage: 1,\n            staffTotal: 0,\n            form: {\n                userId: '',\n                diamond: '',\n                gold: '',\n                level: '',\n                exp: '',\n                extendLevel: '',\n                items: '',\n                rechargeNum: '',\n                pid: '',\n                deltaNum: ''\n            },\n            dialogFormVisible: false,\n            dialogFormVisible2: false,\n            dialogFormVisible3: false,\n            dialogFormVisible4: false,\n            dialogFormVisible5: false,\n            dialogFormVisible6: false,\n            dialogFormVisible7: false,\n            dialogFormVisible8: false,\n            dialogFormVisible9: false,\n            formLabelWidth: '120px',\n            currStaff: {},\n            currStaffTemplate: {},\n            bagItems: [],\n            bagGoods: [],\n            stocks: [],\n            search: {\n                content: '',\n                select: '1'\n            },\n            itemData: {\n                itemList: {},\n                decoShopList: {},\n                staffList: {},\n                goodList: {}\n            }\n        }\n    },\n    methods: {\n        getUsers() {\n            getAllUsers({per_page: this.pagesize, cur_page: this.currentpage}).then(res => {\n                if (res.status === 200) {\n                    console.log(res.data.users)\n                    this.users = res.data.users;\n                    this.total = res.data.total;\n                    this.loading = false;\n                }\n            })\n        },\n        handleSizeChange(value) {\n            this.pagesize = value;\n            this.getUsers();\n        },\n        handleCurrentChange(value) {\n            this.currentpage = value;\n            this.getUsers();\n        },\n        handleStaffSizeChange(value) {\n            this.staffPagesize = value;\n            this.getAllStaffInfo();\n        },\n        handleStaffCurrentChange(value) {\n            this.staffCurrentpage = value;\n            this.getAllStaffInfo();\n        },\n        openDialog(id) {\n            this.form = {\n                userId: id,\n                diamond: '',\n                gold: '',\n                level: '',\n                exp: '',\n                items: '',\n                extendLevel: ''\n            };\n            this.dialogFormVisible = true;\n        },\n        hideDialog() {\n            this.updateUserLoading = false;\n            this.dialogFormVisible = false;\n        },\n        openDialog2(id) {\n            this.bagItems = [];\n            this.bagGoods = [];\n            getBags({userId: id}).then(res => {\n                if (res.status === 200) {\n                    this.bagItems = res.data.bagItems;\n                    this.bagGoods = res.data.bagGoods;\n                }\n            })\n            this.dialogFormVisible2 = true;\n        },\n        hideDialog2() {\n            this.dialogFormVisible2 = false;\n        },\n        updateUser() {\n            if (this.updateUserLoading) {\n                this.$Message.error('点击过快');\n                this.updateUserLoading = false;\n                return\n            }\n            this.updateUserLoading = true;\n            updateUser(this.form).then(res => {\n                if (res.status === 200) {\n                    this.$Message.success('修改成功');\n                } else {\n                    this.$Message.error(res.data);\n                }\n                this.hideDialog();\n                this.getUsers();\n            })\n        },\n        skipNewGuide() {\n            skipNewGuide({userId: this.form.userId}).then(res => {\n                if (res.status === 200) {\n                    this.$Message.success('修改成功');\n                }\n                this.hideDialog();\n            })\n        },\n        searchUser() {\n            searchUser({type: this.search.select, content: this.search.content}).then(res => {\n                if (res.status === 200) {\n                    this.users = res.data.users;\n                    this.total = res.data.total;\n                    this.loading = false;\n                }\n            })\n        },\n        openDialog3(id) {\n            this.form = {\n                userId: id,\n                diamond: '',\n                gold: '',\n                level: '',\n                exp: '',\n                items: '',\n                rechargeNum: ''\n            };\n            this.dialogFormVisible3 = true;\n        },\n        hideDialog3() {\n            this.dialogFormVisible3 = false;\n        },\n        recharge() {\n            recharge({userId: this.form.userId, num: this.form.rechargeNum}).then(res => {\n                if (res.status === 200) {\n                    this.$Message.success('充值成功');\n                }\n            })\n            this.dialogFormVisible3 = false;\n        },\n        openDialog4(id) {\n            this.form = {\n                userId: id,\n                pid: '',\n                deltaNum: ''\n            };\n            queryStock({userId: id}).then(res => {\n                if (res.status === 200) {\n                    debugger\n                    this.stocks = res.data.stocks;\n                    this.dialogFormVisible4 = true;\n                } else {\n                    this.$Message.error(`没找到玩家`)\n                }\n            })\n            this.dialogFormVisible4 = true;\n        },\n        hideDialog4() {\n            this.dialogFormVisible4 = false;\n        },\n        updateStock() {\n            updateStock(this.form).then(res => {\n                if (res.status === 200) {\n                    this.stocks = res.data.stocks;\n                    this.$Message.info('修改成功');\n                }\n            });\n        },\n        openDialog5(id) {\n            this.form.userId = id;\n            getStaffPostInfo({userId: id}).then(res => {\n                if (res.status === 200) {\n                    this.posts = res.data.posts;\n                }\n            })\n            this.dialogFormVisible5 = true;\n        },\n        hideDialog5() {\n            this.dialogFormVisible5 = false;\n        },\n        openDialog6(id) {\n            this.form.userId = id;\n            this.getAllStaffInfo();\n            this.dialogFormVisible6 = true;\n        },\n        getAllStaffInfo() {\n            getAllStaffInfo({\n                userId: this.form.userId,\n                per_page: this.staffPagesize,\n                cur_page: this.staffCurrentpage\n            }).then(res => {\n                if (res.status === 200) {\n                    this.allStaff = res.data.allStaff;\n                    this.staffTotal = res.data.total;\n                }\n            })\n        },\n        hideDialog6() {\n            this.dialogFormVisible6 = false;\n        },\n        openDialog7(staffId) {\n            this.getStaffInfo(staffId);\n            this.dialogFormVisible7 = true;\n        },\n        hideDialog7() {\n            this.dialogFormVisible7 = false;\n        },\n        getStaffInfo(staffId) {\n            getStaffInfo({userId: this.form.userId, staffId: staffId}).then(res => {\n                if (res.status === 200) {\n                    this.currStaff = res.data.staff;\n                    this.currStaffTemplate = {};\n                    this.itemData.staffList.forEach(o => {\n                        if (o.id == this.currStaff.xmlId) {\n                            this.currStaffTemplate = o;\n                        }\n                    })\n                }\n            });\n\n        },\n        oneKeyAdd(type) {\n            let items = [];\n            let badType = [19, 20, 21, 22, 23, 30];\n            switch (type) {\n                case 1:// 道具\n                    items = this.itemData.itemList.filter(o => o.stacking && o.stacking > 999)\n                        .filter(o => badType.findIndex(v => v === o.type) < 0).map(obj => `${obj.id},100`);\n                    break;\n                case 2:// 家具\n                    items = this.itemData.decoShopList.filter(o => o.stacking && o.stacking > 999).map(obj => `${obj.id},100`);\n                    break;\n                case 3:// 员工\n                    items = this.itemData.staffList.map(obj => `${obj.id},1`);\n                    break;\n                case 4:// 货物\n                    items = this.itemData.goodList.map(obj => `${obj.id},100`);\n            }\n            this.form.items = items.join(';');\n            this.updateUser();\n        },\n        getItemList() {\n            getItemList().then(res => {\n                if (res.status === 200) {\n                    this.itemData.decoShopList = res.data.decoShopList;\n                    this.itemData.itemList = res.data.itemList;\n                    this.itemData.staffList = res.data.staffList;\n                    this.itemData.goodList = res.data.goodList;\n                }\n            });\n        },\n        openVip(id) {\n            openVip({userId: id, day: 30}).then(res => {\n                if (res.status === 200 || res == 'hh') {\n                    this.$Message.info('修改成功');\n                }\n            })\n        },\n        openDialog8(userId) {\n            this.form.userId = userId;\n            this.getMarkets();\n            this.dialogFormVisible8 = true;\n        },\n        hideDialog8() {\n            this.dialogFormVisible8 = false;\n        },\n        openFloors() {\n            this.isOpenFloors = true;\n        },\n        closeFloors() {\n            this.isOpenFloors = false;\n        },\n        openDialog9(id, vip) {\n            this.vipInfo = {};\n            this.vipInfo = vip;\n            this.vipInfo.id = id + '';\n            this.dialogFormVisible9 = true;\n        },\n        hideDialog9() {\n            this.dialogFormVisible9 = false;\n        },\n        getMarkets() {\n            getMarkets({userId: this.form.userId}).then(res => {\n                if (res.status === 200) {\n                    this.markets = res.data.markets;\n                }\n            })\n        },\n        showMarket(index) {\n            this.isOpenFloors = false;\n            this.currMarket = index;\n        },\n        isMarketShow(index) {\n            return this.currMarket === index;\n        },\n        decoShopFilter(xmlId) {\n            let str = \"没找到\"\n            this.itemData.decoShopList.forEach(o => {\n                if (o.id == xmlId) {\n                    str = o.name;\n                }\n            })\n            return str;\n        },\n        decoShop2Popularity(xmlId) {\n            let str = \"0\"\n            this.itemData.decoShopList.forEach(o => {\n                if (o.id == xmlId) {\n                    str = o.popularity;\n                }\n            })\n            return str;\n        },\n        floorsMap2Array(map) {\n            let arr = [];\n            for (var key in map) {\n                arr.push({id: key, xmlId: map[key]})\n            }\n            return arr;\n        },\n        Time2DefaultFormat(time) {\n            return util.Time2DefaultFormat(time)\n        }\n    },\n\n}\n",null]}