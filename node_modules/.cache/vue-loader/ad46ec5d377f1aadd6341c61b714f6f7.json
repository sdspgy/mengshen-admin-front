{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/upload-json/uploadJson.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/game/upload-json/uploadJson.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {uploadJson,loadRemoteConfigs,getListByEnable,getJsonByName} from \"@/api/index\";\n\nexport default {\n    name: \"uploadJson\",\n    data () {\n        return {\n            fileList: [],\n            errorList: [],\n            succesList: [],\n            serverList: [],\n            isShow: true,\n            loading: false,\n            fileName:'',\n            jsonStr:'',\n            jsonStrFormat: '',\n            dialogFormVisible: false,\n            columns: [\n                {type: \"index\", width: 60, align: \"center\"},\n                {title: \"服务器名称\", key: \"name\", align: \"center\", width: 150},\n                {title: \"服务器地址\", key: \"address\", align: \"center\", width: 150,},\n                {title: \"端口\", key: \"port\", align: \"center\", width: 100,},\n                {title: \"请求url\", key: \"requestUrl\", align: \"center\", width: 200,},\n                {title: \"加载状态\", key: \"success\", align: \"center\", width: 100,\n                    render: (h, params) => {\n                        if (this.isShow) {\n                            return h(\"div\", params.row.success);\n                        } else  {\n                            return '';\n                        }\n                    }},\n                {title: \"加载远程配置返回信息\", key: \"msg\", align: \"center\", width: 300,},\n            ],\n        }\n    },\n    methods: {\n        init() {\n            this.getServerList();\n        },\n        handleUpload (file) {\n            this.fileList.push(file);\n            return false;\n        },\n        upload () {\n            console.log('>>>>', this.fileList)\n            if (this.fileList.length == 0) {\n                this.$Message.error('未选择文件！');\n                return;\n            }\n            let formData = new FormData();\n            for(var i=0; i< this.fileList.length; i++){\n                formData.append(\"file\",this.fileList[i]);\n            }\n            uploadJson(formData).then(res=>{\n                if (res.status === 200) {\n                    this.fileList = [];\n                    this.$Message.success('上传成功');\n                    this.succesList = res.data.succ;\n                    this.errorList = res.data.error;\n                }else {\n                    this.$Message.error(res.data);\n                }\n            })\n        },\n        deleteFile(index) {\n            this.fileList.splice(index,1);\n        },\n        getServerList() {\n            if (!this.$route.meta.permTypes.includes('other')) {\n                return\n            }\n            getListByEnable().then(res =>{\n                if (res.success){\n                    this.isShow = false;\n                    this.serverList = res.result;\n                }\n            })\n        },\n        loadRemoteConfig() {\n            this.loading = true;\n            loadRemoteConfigs().then(res=>{\n                this.loading = false;\n                this.serverList = res.result;\n            })\n        },\n        openDialog() {\n            this.getJsonByName();\n        },\n        hideDialog() {\n            this.dialogFormVisible = false;\n        },\n        getJsonByName(){\n            this.jsonStr = '';\n            getJsonByName({fileName: this.fileName}).then(res=>{\n                if (res.status === 200){\n                    if (res.data.error){\n                        this.hideDialog();\n                        this.$Message.error(res.data.error);\n                    }else {\n                        this.dialogFormVisible = true;\n                        this.jsonStr = res.data.jsonStr;\n                    }\n                }\n            })\n        },\n        clickCopyPre(){\n            var div = document.getElementById('copyPre');\n            if (document.body.createTextRange) {\n                var range = document.body.createTextRange();\n                range.moveToElementText(div);\n                range.select();\n            } else if (window.getSelection) {\n                var selection = window.getSelection();\n                var range = document.createRange();\n                range.selectNodeContents(div);\n                selection.removeAllRanges();\n                selection.addRange(range);\n            } else {\n                console.warn(\"none\");\n            }\n            document.execCommand(\"Copy\"); // 执行浏览器复制命令\n\n            this.$Message.success(`复制成功`);\n        },\n    },\n    mounted() {\n        this.init();\n    }\n\n}\n",null]}