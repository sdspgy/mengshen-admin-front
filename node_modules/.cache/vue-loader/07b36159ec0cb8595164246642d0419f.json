{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/Login.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { login, userInfo, initCaptcha, drawCodeImage } from \"@/api/index\";\nimport Cookies from \"js-cookie\";\nimport Header from \"@/views/main-components/header\";\nimport LangSwitch from \"@/views/main-components/lang-switch\";\nimport util from \"@/libs/util.js\";\nexport default {\n  components: {\n    LangSwitch,\n    Header\n  },\n  data() {\n    return {\n      captchaId: \"\",\n      captchaImg: \"\",\n      loadingCaptcha: true,\n      error: false,\n      saveLogin: true,\n      getSms: \"获取验证码\",\n      loading: false,\n      sending: false,\n      errorCode: \"\",\n      form: {\n        username: \"\",\n        password: \"\",\n        code: \"\"\n      },\n      rules: {\n        username: [\n          {\n            required: true,\n            message: \"账号不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        password: [\n          {\n            required: true,\n            message: \"密码不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        imgCode: [\n          {\n            required: false,\n            message: \"验证码不能为空\",\n            trigger: \"blur\"\n          }\n        ]\n      }\n    };\n  },\n  methods: {\n    getCaptchaImg() {\n      this.loadingCaptcha = true;\n      initCaptcha().then(res => {\n        this.loadingCaptcha = false;\n        if (res.success) {\n          this.captchaId = res.result;\n          this.captchaImg = drawCodeImage + this.captchaId;\n        }\n      });\n    },\n    submitLogin() {\n        this.$refs.usernameLoginForm.validate(valid => {\n          if (valid) {\n            this.loading = true;\n            login({\n              username: this.form.username,\n              password: this.form.password,\n              code: this.form.imgCode,\n              captchaId: this.captchaId,\n              saveLogin: this.saveLogin\n            }).then(res => {\n              if (res.success) {\n                console.log(res);\n                this.setStore(\"accessToken\", res.result);\n                Cookies.set(\"lastLoginUser\", this.form.username);\n                Cookies.set(this.form.username, this.form.password, {expires: 7});\n                  // 获取用户信息\n\n                console.log(this.getStore(\"accessToken\"));\n                userInfo().then(res => {\n                  if (res.success) {\n                    // 避免超过大小限制\n                    delete res.result.permissions;\n                    let roles = [];\n                    res.result.roles.forEach(e => {\n                      roles.push(e.name);\n                    });\n                    this.setStore(\"roles\", roles);\n                    this.setStore(\"saveLogin\", this.saveLogin);\n                    if (this.saveLogin) {\n                      // 保存7天\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                        expires: 7\n                      });\n                    } else {\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result));\n                    }\n                    this.setStore(\"userInfo\", res.result);\n                    this.$store.commit(\"setAvatarPath\", res.result.avatar);\n                    // 加载菜单\n                    util.initRouter(this);\n                    this.$router.push({\n                      name: \"home_index\"\n                    });\n                  } else {\n                    this.loading = false;\n                  }\n                });\n              } else {\n                this.loading = false;\n                //this.getCaptchaImg();\n              }\n            });\n          }\n        });\n    },\n     getCookie() {\n       this.form.username = Cookies.get(\"lastLoginUser\");\n        if (this.form.username) {\n            this.form.password = Cookies.get(this.form.username);\n        }\n     }\n  },\n  mounted() {\n    //this.getCaptchaImg();\n    this.getCookie();\n  }\n};\n",null]}