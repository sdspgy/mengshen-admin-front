{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/libs/util.js","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/libs/util.js","mtime":1574234031039},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nimport axios from 'axios';\nimport { getMenuList } from '@/api/index';\nimport lazyLoading from './lazyLoading.js';\nimport router from '@/router/index';\nimport Cookies from \"js-cookie\";\nvar util = {};\n\nutil.title = function (title) {\n  title = title || '宝宝超市后台管理系统';\n  window.document.title = title;\n};\n\nutil.inOf = function (arr, targetArr) {\n  var res = true;\n  arr.forEach(function (item) {\n    if (targetArr.indexOf(item) < 0) {\n      res = false;\n    }\n  });\n  return res;\n};\n\nutil.oneOf = function (ele, targetArr) {\n  if (targetArr.indexOf(ele) >= 0) {\n    return true;\n  } else {\n    return false;\n  }\n};\n\nutil.getRouterObjByName = function (routers, name) {\n  if (!name || !routers || !routers.length) {\n    return null;\n  } // debugger;\n\n\n  var routerObj = null;\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = routers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var item = _step.value;\n\n      if (item.name == name) {\n        return item;\n      }\n\n      routerObj = util.getRouterObjByName(item.children, name);\n\n      if (routerObj) {\n        return routerObj;\n      }\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return null;\n};\n\nutil.handleTitle = function (vm, item) {\n  if (_typeof(item.title) == 'object') {\n    return vm.$t(item.title.i18n);\n  } else {\n    return item.title;\n  }\n};\n\nutil.setCurrentPath = function (vm, name) {\n  var title = '';\n  var isOtherRouter = false;\n  vm.$store.state.app.routers.forEach(function (item) {\n    if (item.children.length == 1) {\n      if (item.children[0].name == name) {\n        title = util.handleTitle(vm, item);\n\n        if (item.name == 'otherRouter') {\n          isOtherRouter = true;\n        }\n      }\n    } else {\n      item.children.forEach(function (child) {\n        if (child.name == name) {\n          title = util.handleTitle(vm, child);\n\n          if (item.name == 'otherRouter') {\n            isOtherRouter = true;\n          }\n        }\n      });\n    }\n  });\n  var currentPathArr = [];\n\n  if (name == 'home_index') {\n    currentPathArr = [{\n      title: util.handleTitle(vm, util.getRouterObjByName(vm.$store.state.app.routers, 'home_index')),\n      path: '',\n      name: 'home_index'\n    }];\n  } else if ((name.indexOf('_index') >= 0 || isOtherRouter) && name !== 'home_index') {\n    currentPathArr = [{\n      title: util.handleTitle(vm, util.getRouterObjByName(vm.$store.state.app.routers, 'home_index')),\n      path: '/home',\n      name: 'home_index'\n    }, {\n      title: title,\n      path: '',\n      name: name\n    }];\n  } else {\n    var currentPathObj = vm.$store.state.app.routers.filter(function (item) {\n      if (item.children.length <= 1) {\n        return item.children[0].name == name;\n      } else {\n        var i = 0;\n        var childArr = item.children;\n        var len = childArr.length;\n\n        while (i < len) {\n          if (childArr[i].name == name) {\n            return true;\n          }\n\n          i++;\n        }\n\n        return false;\n      }\n    })[0];\n\n    if (currentPathObj.children.length <= 1 && currentPathObj.name == 'home') {\n      currentPathArr = [{\n        title: '首页',\n        path: '',\n        name: 'home_index'\n      }];\n    } else if (currentPathObj.children.length <= 1 && currentPathObj.name !== 'home') {\n      currentPathArr = [{\n        title: '首页',\n        path: '/home',\n        name: 'home_index'\n      }, {\n        title: currentPathObj.title,\n        path: '',\n        name: name\n      }];\n    } else {\n      var childObj = currentPathObj.children.filter(function (child) {\n        return child.name == name;\n      })[0];\n      currentPathArr = [{\n        title: '首页',\n        path: '/home',\n        name: 'home_index'\n      }, {\n        title: currentPathObj.title,\n        path: '',\n        name: currentPathObj.name\n      }, {\n        title: childObj.title,\n        path: currentPathObj.path + '/' + childObj.path,\n        name: name\n      }];\n    }\n  }\n\n  vm.$store.commit('setCurrentPath', currentPathArr);\n  return currentPathArr;\n};\n\nutil.openNewPage = function (vm, name, argu, query) {\n  if (!vm.$store) {\n    return;\n  }\n\n  var pageOpenedList = vm.$store.state.app.pageOpenedList;\n  var openedPageLen = pageOpenedList.length;\n  var i = 0;\n  var tagHasOpened = false;\n\n  while (i < openedPageLen) {\n    if (name == pageOpenedList[i].name) {\n      // 页面已经打开\n      vm.$store.commit('pageOpenedList', {\n        index: i,\n        argu: argu,\n        query: query\n      });\n      tagHasOpened = true;\n      break;\n    }\n\n    i++;\n  }\n\n  if (!tagHasOpened) {\n    var tag = vm.$store.state.app.tagsList.filter(function (item) {\n      if (item.children) {\n        return name == item.children[0].name;\n      } else {\n        return name == item.name;\n      }\n    });\n    tag = tag[0];\n\n    if (tag) {\n      tag = tag.children ? tag.children[0] : tag;\n\n      if (argu) {\n        tag.argu = argu;\n      }\n\n      if (query) {\n        tag.query = query;\n      }\n\n      vm.$store.commit('increateTag', tag);\n    }\n  }\n\n  vm.$store.commit('setCurrentPageName', name);\n};\n\nutil.toDefaultPage = function (routers, name, route, next) {\n  var len = routers.length;\n  var i = 0;\n  var notHandle = true;\n\n  while (i < len) {\n    if (routers[i].name == name && routers[i].children && routers[i].redirect == undefined) {\n      route.replace({\n        name: routers[i].children[0].name\n      });\n      notHandle = false;\n      next();\n      break;\n    }\n\n    i++;\n  }\n\n  if (notHandle) {\n    next();\n  }\n};\n\nutil.fullscreenEvent = function (vm) {\n  vm.$store.commit('initCachepage');\n};\n\nutil.initRouter = function (vm) {\n  var constRoutes = [];\n  var otherRoutes = []; // 404路由需要和动态路由一起加载\n\n  var otherRouter = [{\n    path: '/*',\n    name: 'error-404',\n    meta: {\n      title: '404-页面不存在'\n    },\n    component: 'error-page/404'\n  }]; // 判断用户是否登录\n\n  var userInfo = Cookies.get('userInfo');\n\n  if (!userInfo) {\n    // 未登录\n    return;\n  }\n\n  if (!vm.$store.state.app.added) {\n    // 第一次加载 读取数据\n    var accessToken = window.localStorage.getItem('accessToken'); // 加载菜单\n\n    axios.get(getMenuList, {\n      headers: {\n        'accessToken': accessToken\n      }\n    }).then(function (res) {\n      var menuData = res.result;\n\n      if (!menuData) {\n        return;\n      }\n\n      util.initAllMenuData(constRoutes, menuData);\n      util.initRouterNode(otherRoutes, otherRouter); // 添加所有主界面路由\n\n      vm.$store.commit('updateAppRouter', constRoutes.filter(function (item) {\n        return item.children.length > 0;\n      })); // 添加全局路由\n\n      vm.$store.commit('updateDefaultRouter', otherRoutes); // 添加菜单路由\n\n      util.initMenuData(vm, menuData); // 缓存数据 修改加载标识\n\n      window.localStorage.setItem('menuData', JSON.stringify(menuData));\n      vm.$store.commit('setAdded', true);\n    });\n  } else {\n    // 读取缓存数据\n    var data = window.localStorage.getItem('menuData');\n\n    if (!data) {\n      vm.$store.commit('setAdded', false);\n      return;\n    }\n\n    var menuData = JSON.parse(data); // 添加菜单路由\n\n    util.initMenuData(vm, menuData);\n  }\n}; // 添加所有顶部导航栏下的菜单路由\n\n\nutil.initAllMenuData = function (constRoutes, data) {\n  var allMenuData = [];\n  data.forEach(function (e) {\n    if (e.type == -1) {\n      e.children.forEach(function (item) {\n        allMenuData.push(item);\n      });\n    }\n  });\n  util.initRouterNode(constRoutes, allMenuData);\n}; // 生成菜单格式数据\n\n\nutil.initMenuData = function (vm, data) {\n  var menuRoutes = [];\n  var menuData = data; // 顶部菜单\n\n  var navList = [];\n  menuData.forEach(function (e) {\n    var nav = {\n      name: e.name,\n      title: e.title,\n      icon: e.icon\n    };\n    navList.push(nav);\n  });\n\n  if (navList.length < 1) {\n    return;\n  } // 存入vuex\n\n\n  vm.$store.commit('setNavList', navList);\n  var currNav = window.localStorage.getItem('currNav');\n\n  if (currNav) {\n    // 读取缓存title\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n      for (var _iterator2 = navList[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n        var item = _step2.value;\n\n        if (item.name == currNav) {\n          vm.$store.commit('setCurrNavTitle', item.title);\n          break;\n        }\n      }\n    } catch (err) {\n      _didIteratorError2 = true;\n      _iteratorError2 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n          _iterator2.return();\n        }\n      } finally {\n        if (_didIteratorError2) {\n          throw _iteratorError2;\n        }\n      }\n    }\n  } else {\n    // 默认第一个\n    currNav = navList[0].name;\n    vm.$store.commit('setCurrNavTitle', navList[0].title);\n  }\n\n  vm.$store.commit('setCurrNav', currNav);\n  var _iteratorNormalCompletion3 = true;\n  var _didIteratorError3 = false;\n  var _iteratorError3 = undefined;\n\n  try {\n    for (var _iterator3 = menuData[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n      var item = _step3.value;\n\n      if (item.name == currNav) {\n        // 过滤\n        menuData = item.children;\n        break;\n      }\n    }\n  } catch (err) {\n    _didIteratorError3 = true;\n    _iteratorError3 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n        _iterator3.return();\n      }\n    } finally {\n      if (_didIteratorError3) {\n        throw _iteratorError3;\n      }\n    }\n  }\n\n  util.initRouterNode(menuRoutes, menuData); // 刷新界面菜单\n\n  vm.$store.commit('updateMenulist', menuRoutes.filter(function (item) {\n    return item.children.length > 0;\n  }));\n  var tagsList = [];\n  vm.$store.state.app.routers.map(function (item) {\n    if (item.children.length <= 1) {\n      tagsList.push(item.children[0]);\n    } else {\n      tagsList.push.apply(tagsList, _toConsumableArray(item.children));\n    }\n  });\n  vm.$store.commit('setTagsList', tagsList);\n}; // 生成路由节点\n\n\nutil.initRouterNode = function (routers, data) {\n  var _iteratorNormalCompletion4 = true;\n  var _didIteratorError4 = false;\n  var _iteratorError4 = undefined;\n\n  try {\n    for (var _iterator4 = data[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n      var item = _step4.value;\n      var menu = Object.assign({}, item); // menu.component = import(`@/views/${menu.component}.vue`);\n\n      menu.component = lazyLoading(menu.component);\n\n      if (item.children && item.children.length > 0) {\n        menu.children = [];\n        util.initRouterNode(menu.children, item.children);\n      }\n\n      var meta = {}; // 给页面添加权限、标题、第三方网页链接\n\n      meta.permTypes = menu.permTypes ? menu.permTypes : null;\n      meta.title = menu.title ? menu.title + \" - 宝宝超市后台管理系统 By: 互爱科技\" : null;\n      meta.url = menu.url ? menu.url : null;\n      menu.meta = meta;\n      routers.push(menu);\n    }\n  } catch (err) {\n    _didIteratorError4 = true;\n    _iteratorError4 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion4 && _iterator4.return != null) {\n        _iterator4.return();\n      }\n    } finally {\n      if (_didIteratorError4) {\n        throw _iteratorError4;\n      }\n    }\n  }\n};\n\nutil.formatDate = function (date, fmt) {\n  if (/(y+)/.test(fmt)) {\n    fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));\n  }\n\n  var o = {\n    'M+': date.getMonth() + 1,\n    'd+': date.getDate(),\n    'H+': date.getHours(),\n    'm+': date.getMinutes(),\n    's+': date.getSeconds()\n  };\n\n  for (var k in o) {\n    if (new RegExp(\"(\".concat(k, \")\")).test(fmt)) {\n      var str = o[k] + '';\n      fmt = fmt.replace(RegExp.$1, RegExp.$1.length === 1 ? str : padLeftZero(str));\n    }\n  }\n\n  return fmt;\n};\n\nfunction padLeftZero(str) {\n  return ('00' + str).substr(str.length);\n}\n/** 时间戳或时间字符串 to 默认格式字符串*/\n\n\nutil.Time2DefaultFormat = function (timeStamp, fmt) {\n  fmt = fmt || 'yyyy-MM-dd HH:mm:ss';\n  return this.formatDate(new Date(timeStamp), fmt);\n};\n\nexport default util;",null]}