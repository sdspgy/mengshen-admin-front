{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/sys/user-manage/userManage.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/sys/user-manage/userManage.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getUserListData, getAllRoleList, addUser, editUser, enableUser, disableUser, deleteUser, getAllUserData, resetUserPass } from \"@/api/index\";\nimport expandRow from \"./expand.vue\";\nimport { validateMobile, validatePassword } from \"@/libs/validate\";\nimport uploadPicInput from \"../../my-components/rbac/upload-pic-input\";\nimport circleLoading from \"../../my-components/circle-loading.vue\";\nimport checkPassword from \"@/views/my-components/rbac/check-password\";\nexport default {\n  name: \"user-manage\",\n  components: {\n    circleLoading: circleLoading,\n    expandRow: expandRow,\n    uploadPicInput: uploadPicInput,\n    checkPassword: checkPassword\n  },\n  data: function data() {\n    var _this = this;\n\n    return {\n      loading: true,\n      operationLoading: false,\n      loadingExport: true,\n      modalExportAll: false,\n      drop: false,\n      dropDownContent: \"展开\",\n      dropDownIcon: \"ios-arrow-down\",\n      selectCount: 0,\n      selectList: [],\n      dataDep: [],\n      searchKey: \"\",\n      searchForm: {\n        username: \"\",\n        mobile: \"\",\n        email: \"\",\n        sex: \"\",\n        type: \"\",\n        status: \"\",\n        pageNumber: 1,\n        pageSize: 10,\n        sort: \"createTime\",\n        order: \"desc\",\n        startDate: \"\",\n        endDate: \"\"\n      },\n      selectDate: null,\n      modalType: 0,\n      userModalVisible: false,\n      modalTitle: \"\",\n      userForm: {\n        username: \"\",\n        mobile: \"\",\n        email: \"\",\n        sex: \"保密\",\n        type: 0,\n        avatar: \"\",\n        roles: []\n      },\n      userRoles: [],\n      roleList: [],\n      errorPass: \"\",\n\n      /** 表单验证，未使用 */\n      userFormValidate: {\n        username: [{\n          required: true,\n          message: \"账号不能为空\",\n          trigger: \"blur\"\n        }],\n        mobile: [{\n          required: true,\n          message: \"手机号不能为空\",\n          trigger: \"blur\"\n        }, {\n          validator: validateMobile,\n          trigger: \"blur\"\n        }],\n        email: [{\n          required: true,\n          message: \"请输入邮箱地址\"\n        }, {\n          type: \"email\",\n          message: \"邮箱格式不正确\"\n        }]\n      },\n      submitLoading: false,\n      columns: [{\n        type: \"selection\",\n        width: 60,\n        align: \"center\",\n        fixed: \"left\"\n      }, {\n        type: \"expand\",\n        width: 50,\n        fixed: \"left\",\n        render: function render(h, params) {\n          return h(expandRow, {\n            props: {\n              row: params.row\n            }\n          });\n        }\n      }, {\n        type: \"index\",\n        width: 60,\n        align: \"center\",\n        fixed: \"left\"\n      }, {\n        title: \"用户名\",\n        key: \"username\",\n        minWidth: 145,\n        sortable: true,\n        fixed: \"left\"\n      }, {\n        title: \"头像\",\n        key: \"avatar\",\n        width: 80,\n        align: \"center\",\n        render: function render(h, params) {\n          return h(\"Avatar\", {\n            props: {\n              src: params.row.avatar\n            }\n          });\n        }\n      }, {\n        title: \"手机\",\n        key: \"mobile\",\n        width: 115,\n        sortable: true\n      }, {\n        title: \"邮箱\",\n        key: \"email\",\n        width: 180,\n        sortable: true\n      }, {\n        title: \"性别\",\n        key: \"sex\",\n        width: 70,\n        align: \"center\"\n      }, {\n        title: \"用户类型\",\n        key: \"type\",\n        align: \"center\",\n        width: 100,\n        render: function render(h, params) {\n          var re = \"\";\n\n          if (params.row.type == 1) {\n            re = \"管理员\";\n          } else if (params.row.type == 0) {\n            re = \"普通用户\";\n          }\n\n          return h(\"div\", re);\n        }\n      }, {\n        title: \"状态\",\n        key: \"status\",\n        align: \"center\",\n        width: 140,\n        render: function render(h, params) {\n          if (params.row.status == 0) {\n            return h(\"div\", [h(\"Badge\", {\n              props: {\n                status: \"success\",\n                text: \"正常启用\"\n              }\n            })]);\n          } else if (params.row.status == -1) {\n            return h(\"div\", [h(\"Badge\", {\n              props: {\n                status: \"error\",\n                text: \"禁用\"\n              }\n            })]);\n          }\n        },\n        filters: [{\n          label: \"正常启用\",\n          value: 0\n        }, {\n          label: \"禁用\",\n          value: -1\n        }],\n        filterMultiple: false,\n        filterMethod: function filterMethod(value, row) {\n          if (value == 0) {\n            return row.status == 0;\n          } else if (value == -1) {\n            return row.status == -1;\n          }\n        }\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\",\n        sortable: true,\n        sortType: \"desc\",\n        width: 150\n      }, {\n        title: \"操作\",\n        key: \"action\",\n        width: 200,\n        align: \"center\",\n        fixed: \"right\",\n        render: function render(h, params) {\n          var enableOrDisable = \"\";\n          var editButton = h(\"Button\", {\n            props: {\n              type: \"primary\",\n              size: \"small\",\n              disabled: !_this.$route.meta.permTypes.includes('edit')\n            },\n            style: {\n              marginRight: \"5px\"\n            },\n            on: {\n              click: function click() {\n                _this.edit(params.row);\n              }\n            }\n          }, \"编辑\");\n\n          if (params.row.status == 0) {\n            enableOrDisable = h(\"Button\", {\n              props: {\n                size: \"small\",\n                disabled: !_this.$route.meta.permTypes.includes('disable')\n              },\n              style: {\n                marginRight: \"5px\"\n              },\n              on: {\n                click: function click() {\n                  _this.disable(params.row);\n                }\n              }\n            }, \"禁用\");\n          } else {\n            enableOrDisable = h(\"Button\", {\n              props: {\n                type: \"success\",\n                size: \"small\",\n                disabled: !_this.$route.meta.permTypes.includes('enable')\n              },\n              style: {\n                marginRight: \"5px\"\n              },\n              on: {\n                click: function click() {\n                  _this.enable(params.row);\n                }\n              }\n            }, \"启用\");\n          }\n\n          ;\n          var deleteButton = h(\"Button\", {\n            props: {\n              type: \"error\",\n              size: \"small\",\n              disabled: !_this.$route.meta.permTypes.includes('delete')\n            },\n            on: {\n              click: function click() {\n                _this.remove(params.row);\n              }\n            }\n          }, \"删除\");\n          return h(\"div\", [editButton, enableOrDisable, deleteButton]);\n        }\n      }],\n      exportColumns: [{\n        title: \"用户名\",\n        key: \"username\"\n      }, {\n        title: \"头像\",\n        key: \"avatar\"\n      }, {\n        title: \"手机\",\n        key: \"mobile\"\n      }, {\n        title: \"邮箱\",\n        key: \"email\"\n      }, {\n        title: \"性别\",\n        key: \"sex\"\n      }, {\n        title: \"用户类型\",\n        key: \"type\"\n      }, {\n        title: \"状态\",\n        key: \"status\"\n      }, {\n        title: \"删除标志\",\n        key: \"delFlag\"\n      }, {\n        title: \"创建时间\",\n        key: \"createTime\"\n      }, {\n        title: \"更新时间\",\n        key: \"updateTime\"\n      }],\n      data: [],\n      exportData: [],\n      total: 0,\n      dictSex: this.$store.state.dict.sex\n    };\n  },\n  methods: {\n    init: function init() {\n      this.getUserList();\n    },\n    changePage: function changePage(v) {\n      this.searchForm.pageNumber = v;\n      this.getUserList();\n      this.clearSelectAll();\n    },\n    changePageSize: function changePageSize(v) {\n      this.searchForm.pageSize = v;\n      this.getUserList();\n    },\n    selectDateRange: function selectDateRange(v) {\n      if (v) {\n        this.searchForm.startDate = v[0];\n        this.searchForm.endDate = v[1];\n      }\n    },\n    getUserList: function getUserList() {\n      var _this2 = this;\n\n      if (!this.$route.meta.permTypes.includes('view')) {\n        this.loading = false;\n        return;\n      } // 多条件搜索用户列表\n\n\n      this.loading = true; // 避免后台默认值\n\n      if (!this.searchForm.type) {\n        this.searchForm.type = \"\";\n      }\n\n      if (!this.searchForm.status) {\n        this.searchForm.status = \"\";\n      }\n\n      getUserListData(this.searchForm).then(function (res) {\n        _this2.loading = false;\n\n        if (res.success) {\n          _this2.data = res.result.records;\n          _this2.total = res.result.total;\n\n          if (res.result.content || res.result.totalElements) {\n            _this2.data = res.result.content;\n            _this2.total = res.result.totalElements;\n          }\n        }\n      });\n    },\n    handleSearch: function handleSearch() {\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.getUserList();\n    },\n    handleReset: function handleReset() {\n      this.$refs.searchForm.resetFields();\n      this.searchForm.pageNumber = 1;\n      this.searchForm.pageSize = 10;\n      this.selectDate = null;\n      this.searchForm.startDate = \"\";\n      this.searchForm.endDate = \"\";\n      this.selectDep = []; // 重新加载数据\n\n      this.getUserList();\n    },\n    changeSort: function changeSort(e) {\n      this.searchForm.sort = e.key;\n      this.searchForm.order = e.order;\n\n      if (e.order == \"normal\") {\n        this.searchForm.order = \"\";\n      }\n\n      this.getUserList();\n    },\n    getRoleList: function getRoleList() {\n      var _this3 = this;\n\n      getAllRoleList().then(function (res) {\n        if (res.success) {\n          _this3.roleList = res.result;\n        }\n      });\n    },\n    handleDropdown: function handleDropdown(name) {\n      var _this4 = this;\n\n      if (name == \"refresh\") {\n        this.getUserList();\n      } else if (name == \"reset\") {\n        if (this.selectCount <= 0) {\n          this.$Message.warning(\"您还未选择要重置密码的用户\");\n          return;\n        }\n\n        this.$refs.checkPass.show();\n      } else if (name == \"exportData\") {\n        if (this.selectCount <= 0) {\n          this.$Message.warning(\"您还未选择要导出的数据\");\n          return;\n        }\n\n        this.$Modal.confirm({\n          title: \"确认导出\",\n          content: \"您确认要导出所选 \" + this.selectCount + \" 条数据?\",\n          onOk: function onOk() {\n            _this4.$refs.exportTable.exportCsv({\n              filename: \"用户数据\"\n            });\n          }\n        });\n      } else if (name == \"exportAll\") {\n        this.modalExportAll = true;\n      }\n    },\n    exportAll: function exportAll() {\n      var _this5 = this;\n\n      getAllUserData().then(function (res) {\n        _this5.modalExportAll = false;\n\n        if (res.success) {\n          _this5.exportData = res.result;\n          setTimeout(function () {\n            _this5.$refs.exportTable.exportCsv({\n              filename: \"用户全部数据\"\n            });\n          }, 1000);\n        }\n      });\n    },\n    resetPass: function resetPass() {\n      var _this6 = this;\n\n      this.$Modal.confirm({\n        title: \"确认重置\",\n        content: \"您确认要重置所选的 \" + this.selectCount + \" 条用户数据密码为【123456】?\",\n        loading: true,\n        onOk: function onOk() {\n          var ids = \"\";\n\n          _this6.selectList.forEach(function (e) {\n            ids += e.id + \",\";\n          });\n\n          ids = ids.substring(0, ids.length - 1);\n          resetUserPass({\n            ids: ids\n          }).then(function (res) {\n            _this6.$Modal.remove();\n\n            if (res.success) {\n              _this6.$Message.success(\"操作成功\");\n\n              _this6.clearSelectAll();\n\n              _this6.getUserList();\n            }\n          });\n        }\n      });\n    },\n    submitUser: function submitUser() {\n      var _this7 = this;\n\n      this.$refs.userForm.validate(function (valid) {\n        if (valid) {\n          if (_this7.modalType == 0) {\n            // 添加用户 避免编辑后传入id\n            delete _this7.userForm.id;\n            delete _this7.userForm.status;\n\n            if (_this7.userForm.password == \"\" || _this7.userForm.password == undefined) {\n              _this7.errorPass = \"密码不能为空\";\n              return;\n            }\n\n            if (_this7.userForm.password.length < 6) {\n              _this7.errorPass = \"密码长度不得少于6位\";\n              return;\n            }\n\n            _this7.submitLoading = true;\n            addUser({\n              username: _this7.userForm.username,\n              password: _this7.userForm.password,\n              mobile: _this7.userForm.mobile,\n              email: _this7.userForm.email,\n              sex: _this7.userForm.sex,\n              type: _this7.userForm.type,\n              avatar: _this7.userForm.avatar,\n              roles0: _this7.userForm.roles\n            }).then(function (res) {\n              _this7.submitLoading = false;\n\n              if (res.success) {\n                _this7.$Message.success(\"操作成功\");\n\n                _this7.getUserList();\n\n                _this7.userModalVisible = false;\n              }\n            });\n          } else {\n            // 编辑\n            _this7.submitLoading = true;\n            editUser({\n              id: _this7.userForm.id,\n              username: _this7.userForm.username,\n              mobile: _this7.userForm.mobile,\n              email: _this7.userForm.email,\n              sex: _this7.userForm.sex,\n              type: _this7.userForm.type,\n              avatar: _this7.userForm.avatar,\n              status: _this7.userForm.status,\n              roles0: _this7.userForm.roles\n            }).then(function (res) {\n              _this7.submitLoading = false;\n\n              if (res.success) {\n                _this7.$Message.success(\"操作成功\");\n\n                _this7.getUserList();\n\n                _this7.userModalVisible = false;\n              }\n            });\n          }\n        }\n      });\n    },\n    add: function add() {\n      this.modalType = 0;\n      this.modalTitle = \"添加用户\";\n      this.$refs.userForm.resetFields();\n      this.userModalVisible = true;\n    },\n    edit: function edit(v) {\n      this.modalType = 1;\n      this.modalTitle = \"编辑用户\";\n      this.$refs.userForm.resetFields(); // 转换null为\"\"\n\n      for (var attr in v) {\n        if (v[attr] == null) {\n          v[attr] = \"\";\n        }\n      }\n\n      var str = JSON.stringify(v);\n      var data = JSON.parse(str);\n      this.userForm = data;\n      var selectRolesId = [];\n      this.userForm.roles.forEach(function (e) {\n        selectRolesId.push(e.id);\n      });\n      this.userForm.roles = selectRolesId;\n      this.userModalVisible = true;\n    },\n    enable: function enable(v) {\n      var _this8 = this;\n\n      this.$Modal.confirm({\n        title: \"确认启用\",\n        content: \"您确认要启用用户 \" + v.username + \" ?\",\n        loading: true,\n        onOk: function onOk() {\n          enableUser(v.id).then(function (res) {\n            _this8.$Modal.remove();\n\n            if (res.success) {\n              _this8.$Message.success(\"操作成功\");\n\n              _this8.getUserList();\n            }\n          });\n        }\n      });\n    },\n    disable: function disable(v) {\n      var _this9 = this;\n\n      this.$Modal.confirm({\n        title: \"确认禁用\",\n        content: \"您确认要禁用用户 \" + v.username + \" ?\",\n        loading: true,\n        onOk: function onOk() {\n          disableUser(v.id).then(function (res) {\n            _this9.$Modal.remove();\n\n            if (res.success) {\n              _this9.$Message.success(\"操作成功\");\n\n              _this9.getUserList();\n            }\n          });\n        }\n      });\n    },\n    remove: function remove(v) {\n      var _this10 = this;\n\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除用户 \" + v.username + \" ?\",\n        loading: true,\n        onOk: function onOk() {\n          deleteUser(v.id).then(function (res) {\n            _this10.$Modal.remove();\n\n            if (res.success) {\n              _this10.$Message.success(\"删除成功\");\n\n              _this10.getUserList();\n            }\n          });\n        }\n      });\n    },\n    dropDown: function dropDown() {\n      if (this.drop) {\n        this.dropDownContent = \"展开\";\n        this.dropDownIcon = \"ios-arrow-down\";\n      } else {\n        this.dropDownContent = \"收起\";\n        this.dropDownIcon = \"ios-arrow-up\";\n      }\n\n      this.drop = !this.drop;\n    },\n    showSelect: function showSelect(e) {\n      this.exportData = e;\n      this.selectList = e;\n      this.selectCount = e.length;\n    },\n    clearSelectAll: function clearSelectAll() {\n      this.$refs.table.selectAll(false);\n    },\n    delAll: function delAll() {\n      var _this11 = this;\n\n      if (this.selectCount <= 0) {\n        this.$Message.warning(\"您还未选择要删除的数据\");\n        return;\n      }\n\n      this.$Modal.confirm({\n        title: \"确认删除\",\n        content: \"您确认要删除所选的 \" + this.selectCount + \" 条数据?\",\n        loading: true,\n        onOk: function onOk() {\n          var ids = \"\";\n\n          _this11.selectList.forEach(function (e) {\n            ids += e.id + \",\";\n          });\n\n          ids = ids.substring(0, ids.length - 1);\n          deleteUser(ids).then(function (res) {\n            _this11.$Modal.remove();\n\n            if (res.success) {\n              _this11.$Message.success(\"删除成功\");\n\n              _this11.clearSelectAll();\n\n              _this11.getUserList();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n    this.getRoleList();\n  }\n};",null]}