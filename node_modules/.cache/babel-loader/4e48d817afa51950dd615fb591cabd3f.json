{"remainingRequest":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/src/views/Login.vue","mtime":1574132205000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/hoolai/Documents/tyz/workspace-ws/baobao-admin-front/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { login, userInfo, initCaptcha, drawCodeImage } from \"@/api/index\";\nimport Cookies from \"js-cookie\";\nimport Header from \"@/views/main-components/header\";\nimport LangSwitch from \"@/views/main-components/lang-switch\";\nimport util from \"@/libs/util.js\";\nexport default {\n  components: {\n    LangSwitch: LangSwitch,\n    Header: Header\n  },\n  data: function data() {\n    return {\n      captchaId: \"\",\n      captchaImg: \"\",\n      loadingCaptcha: true,\n      error: false,\n      saveLogin: true,\n      getSms: \"获取验证码\",\n      loading: false,\n      sending: false,\n      errorCode: \"\",\n      form: {\n        username: \"\",\n        password: \"\",\n        code: \"\"\n      },\n      rules: {\n        username: [{\n          required: true,\n          message: \"账号不能为空\",\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"密码不能为空\",\n          trigger: \"blur\"\n        }],\n        imgCode: [{\n          required: false,\n          message: \"验证码不能为空\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  methods: {\n    getCaptchaImg: function getCaptchaImg() {\n      var _this = this;\n\n      this.loadingCaptcha = true;\n      initCaptcha().then(function (res) {\n        _this.loadingCaptcha = false;\n\n        if (res.success) {\n          _this.captchaId = res.result;\n          _this.captchaImg = drawCodeImage + _this.captchaId;\n        }\n      });\n    },\n    submitLogin: function submitLogin() {\n      var _this2 = this;\n\n      this.$refs.usernameLoginForm.validate(function (valid) {\n        if (valid) {\n          _this2.loading = true;\n          login({\n            username: _this2.form.username,\n            password: _this2.form.password,\n            code: _this2.form.imgCode,\n            captchaId: _this2.captchaId,\n            saveLogin: _this2.saveLogin\n          }).then(function (res) {\n            if (res.success) {\n              console.log(res);\n\n              _this2.setStore(\"accessToken\", res.result);\n\n              Cookies.set(\"lastLoginUser\", _this2.form.username);\n              Cookies.set(_this2.form.username, _this2.form.password, {\n                expires: 7\n              }); // 获取用户信息\n\n              console.log(_this2.getStore(\"accessToken\"));\n              userInfo().then(function (res) {\n                if (res.success) {\n                  // 避免超过大小限制\n                  delete res.result.permissions;\n                  var roles = [];\n                  res.result.roles.forEach(function (e) {\n                    roles.push(e.name);\n                  });\n\n                  _this2.setStore(\"roles\", roles);\n\n                  _this2.setStore(\"saveLogin\", _this2.saveLogin);\n\n                  if (_this2.saveLogin) {\n                    // 保存7天\n                    Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                      expires: 7\n                    });\n                  } else {\n                    Cookies.set(\"userInfo\", JSON.stringify(res.result));\n                  }\n\n                  _this2.setStore(\"userInfo\", res.result);\n\n                  _this2.$store.commit(\"setAvatarPath\", res.result.avatar); // 加载菜单\n\n\n                  util.initRouter(_this2);\n\n                  _this2.$router.push({\n                    name: \"home_index\"\n                  });\n                } else {\n                  _this2.loading = false;\n                }\n              });\n            } else {\n              _this2.loading = false; //this.getCaptchaImg();\n            }\n          });\n        }\n      });\n    },\n    getCookie: function getCookie() {\n      this.form.username = Cookies.get(\"lastLoginUser\");\n\n      if (this.form.username) {\n        this.form.password = Cookies.get(this.form.username);\n      }\n    }\n  },\n  mounted: function mounted() {\n    //this.getCaptchaImg();\n    this.getCookie();\n  }\n};",{"version":3,"sources":["Login.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"login\">\n    <Row type=\"flex\" justify=\"center\" align=\"middle\" @keydown.enter.native=\"submitLogin\">\n      <Col style=\"width: 368px;\">\n        <Header/>\n        <Row>\n          <Tabs>\n            <TabPane :label=\"$t('usernameLogin')\" name=\"username\" icon=\"md-person\">\n                <Form\n                        ref=\"usernameLoginForm\"\n                        :model=\"form\"\n                        :rules=\"rules\"\n                        class=\"form\">\n                    <FormItem prop=\"username\">\n                        <Input\n                                v-model=\"form.username\"\n                                prefix=\"ios-contact\"\n                                size=\"large\"\n                                clearable\n                                placeholder=\"请输入用户名\"\n                                autocomplete=\"off\"\n                        />\n                    </FormItem>\n                    <FormItem prop=\"password\">\n                        <Input\n                                type=\"password\"\n                                v-model=\"form.password\"\n                                prefix=\"ios-lock\"\n                                size=\"large\"\n                                clearable\n                                placeholder=\"请输入密码\"\n                                autocomplete=\"off\"\n                        />\n                    </FormItem>\n                </Form>\n            </TabPane>\n          </Tabs>\n          <Row>\n            <Button\n              class=\"login-btn\"\n              type=\"primary\"\n              size=\"large\"\n              :loading=\"loading\"\n              @click=\"submitLogin\"\n              long>\n              <span v-if=\"!loading\">{{ $t('login') }}</span>\n              <span v-else>{{ $t('logining') }}</span>\n            </Button>\n          </Row>\n        </Row>\n      </Col>\n      <LangSwitch />\n    </Row>\n  </div>\n</template>\n\n<script>\nimport { login, userInfo, initCaptcha, drawCodeImage } from \"@/api/index\";\nimport Cookies from \"js-cookie\";\nimport Header from \"@/views/main-components/header\";\nimport LangSwitch from \"@/views/main-components/lang-switch\";\nimport util from \"@/libs/util.js\";\nexport default {\n  components: {\n    LangSwitch,\n    Header\n  },\n  data() {\n    return {\n      captchaId: \"\",\n      captchaImg: \"\",\n      loadingCaptcha: true,\n      error: false,\n      saveLogin: true,\n      getSms: \"获取验证码\",\n      loading: false,\n      sending: false,\n      errorCode: \"\",\n      form: {\n        username: \"\",\n        password: \"\",\n        code: \"\"\n      },\n      rules: {\n        username: [\n          {\n            required: true,\n            message: \"账号不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        password: [\n          {\n            required: true,\n            message: \"密码不能为空\",\n            trigger: \"blur\"\n          }\n        ],\n        imgCode: [\n          {\n            required: false,\n            message: \"验证码不能为空\",\n            trigger: \"blur\"\n          }\n        ]\n      }\n    };\n  },\n  methods: {\n    getCaptchaImg() {\n      this.loadingCaptcha = true;\n      initCaptcha().then(res => {\n        this.loadingCaptcha = false;\n        if (res.success) {\n          this.captchaId = res.result;\n          this.captchaImg = drawCodeImage + this.captchaId;\n        }\n      });\n    },\n    submitLogin() {\n        this.$refs.usernameLoginForm.validate(valid => {\n          if (valid) {\n            this.loading = true;\n            login({\n              username: this.form.username,\n              password: this.form.password,\n              code: this.form.imgCode,\n              captchaId: this.captchaId,\n              saveLogin: this.saveLogin\n            }).then(res => {\n              if (res.success) {\n                console.log(res);\n                this.setStore(\"accessToken\", res.result);\n                Cookies.set(\"lastLoginUser\", this.form.username);\n                Cookies.set(this.form.username, this.form.password, {expires: 7});\n                  // 获取用户信息\n\n                console.log(this.getStore(\"accessToken\"));\n                userInfo().then(res => {\n                  if (res.success) {\n                    // 避免超过大小限制\n                    delete res.result.permissions;\n                    let roles = [];\n                    res.result.roles.forEach(e => {\n                      roles.push(e.name);\n                    });\n                    this.setStore(\"roles\", roles);\n                    this.setStore(\"saveLogin\", this.saveLogin);\n                    if (this.saveLogin) {\n                      // 保存7天\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n                        expires: 7\n                      });\n                    } else {\n                      Cookies.set(\"userInfo\", JSON.stringify(res.result));\n                    }\n                    this.setStore(\"userInfo\", res.result);\n                    this.$store.commit(\"setAvatarPath\", res.result.avatar);\n                    // 加载菜单\n                    util.initRouter(this);\n                    this.$router.push({\n                      name: \"home_index\"\n                    });\n                  } else {\n                    this.loading = false;\n                  }\n                });\n              } else {\n                this.loading = false;\n                //this.getCaptchaImg();\n              }\n            });\n          }\n        });\n    },\n     getCookie() {\n       this.form.username = Cookies.get(\"lastLoginUser\");\n        if (this.form.username) {\n            this.form.password = Cookies.get(this.form.username);\n        }\n     }\n  },\n  mounted() {\n    //this.getCaptchaImg();\n    this.getCookie();\n  }\n};\n</script>\n\n<style lang=\"less\">\n@import \"./login.less\";\n</style>\n"],"sourceRoot":"src/views"}]}